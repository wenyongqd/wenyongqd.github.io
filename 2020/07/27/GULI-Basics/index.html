<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          GULI Basics - Wenyong的博客 | Wenyong&#39;s Blog
        
    </title>

    <link rel="canonical" href="https://wenyongqd.github.io/2020/07/27/GULI-Basics/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Wenyong&#39;s Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archives/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="https://wenyongqd.github.io/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                    </div>
                    <h1>GULI Basics</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by Wenyong He on
                        2020-07-27
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="1-谷粒商城分布式基础篇"><a href="#1-谷粒商城分布式基础篇" class="headerlink" title="1.谷粒商城分布式基础篇"></a>1.谷粒商城分布式基础篇</h1><h2 id="1-整体介绍"><a href="#1-整体介绍" class="headerlink" title="1. 整体介绍"></a>1. 整体介绍</h2><p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341333458-8d857cd7-79e1-4e99-9ba4-425bc650be2a.png#align=left&amp;display=inline&amp;height=800&amp;margin=%5Bobject%20Object%5D&amp;originHeight=800&amp;originWidth=1466&amp;status=done&amp;style=none&amp;width=1466" alt></p>
<h3 id="1）安装vagrant"><a href="#1）安装vagrant" class="headerlink" title="1）安装vagrant"></a>1）安装vagrant</h3><h3 id="2）安装Centos7"><a href="#2）安装Centos7" class="headerlink" title="2）安装Centos7"></a>2）安装Centos7</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vagrant init centos/7</span></span><br><span class="line">A `Vagrantfile` has been placed in this directory. You are now</span><br><span class="line">ready to `vagrant up` your first virtual environment! Please read</span><br><span class="line">the comments in the Vagrantfile as well as documentation on</span><br><span class="line">`vagrantup.com` for more information on using Vagrant.</span><br></pre></td></tr></table></figure>
<p>执行完上面的命令后，会在用户的家目录下生成Vagrantfile文件。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vagrant up</span></span><br><span class="line">Bringing machine 'default' up with 'virtualbox' provider...</span><br><span class="line">==&gt; default: Box 'centos/7' could not be found. Attempting to find and install...</span><br><span class="line">    default: Box Provider: virtualbox</span><br><span class="line">    default: Box Version: &gt;= 0</span><br><span class="line">==&gt; default: Loading metadata for box 'centos/7'</span><br><span class="line">    default: URL: https://vagrantcloud.com/centos/7</span><br><span class="line">==&gt; default: Adding box 'centos/7' (v1905.1) for provider: virtualbox</span><br><span class="line">    default: Downloading: https://vagrantcloud.com/centos/boxes/7/versions/1905.1/providers/virtualbox.box</span><br><span class="line">    default: Download redirected to host: cloud.centos.org</span><br><span class="line">    default: Progress: 0% (Rate: 6717/s, Estimated time remaining: 7:33:42)</span><br></pre></td></tr></table></figure></p>
<p>下载镜像过程比较漫长，也可以采用先用下载工具下载到本地后，然后使用“ vagrant box add ”添加，再“vagrant up”即可<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将下载的镜像添加到virtualBox中</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vagrant box add centos/7 E:\迅雷下载\CentOS-7-x86_64-Vagrant-1905_01.VirtualBox.box</span></span><br><span class="line">==&gt; box: Box file was not detected as metadata. Adding it directly...</span><br><span class="line">==&gt; box: Adding box 'centos/7' (v0) for provider:</span><br><span class="line">    box: Unpacking necessary files from: file:///E:/%D1%B8%C0%D7%CF%C2%D4%D8/CentOS-7-x86_64-Vagrant-1905_01.VirtualBox.box</span><br><span class="line">    box:</span><br><span class="line">==&gt; box: Successfully added box 'centos/7' (v0) for 'virtualbox'!</span><br><span class="line"><span class="meta">#</span><span class="bash">启动</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vagrant up</span></span><br><span class="line">Bringing machine 'default' up with 'virtualbox' provider...</span><br><span class="line">==&gt; default: Importing base box 'centos/7'...</span><br><span class="line">==&gt; default: Matching MAC address for NAT networking...</span><br><span class="line">==&gt; default: Setting the name of the VM: Administrator_default_1588497928070_24634</span><br><span class="line">==&gt; default: Clearing any previously set network interfaces...</span><br><span class="line">==&gt; default: Preparing network interfaces based on configuration...</span><br><span class="line">    default: Adapter 1: nat</span><br><span class="line">    default: Adapter 2: hostonly</span><br><span class="line">==&gt; default: Forwarding ports...</span><br><span class="line">    default: 22 (guest) =&gt; 2222 (host) (adapter 1)</span><br><span class="line">==&gt; default: Booting VM...</span><br><span class="line">==&gt; default: Waiting for machine to boot. This may take a few minutes...</span><br><span class="line">    default: SSH address: 127.0.0.1:2222</span><br><span class="line">    default: SSH username: vagrant</span><br><span class="line">    default: SSH auth method: private key</span><br><span class="line">    default:</span><br><span class="line">    default: Vagrant insecure key detected. Vagrant will automatically replace</span><br><span class="line">    default: this with a newly generated keypair for better security.</span><br><span class="line">    default:</span><br><span class="line">    default: Inserting generated public key within guest...</span><br><span class="line">    default: Removing insecure key from the guest if it's present...</span><br><span class="line">    default: Key inserted! Disconnecting and reconnecting using new SSH key...</span><br><span class="line">==&gt; default: Machine booted and ready!</span><br><span class="line">==&gt; default: Checking for guest additions in VM...</span><br><span class="line">    default: No guest additions were detected on the base box for this VM! Guest</span><br><span class="line">    default: additions are required for forwarded ports, shared folders, host only</span><br><span class="line">    default: networking, and more. If SSH fails on this machine, please install</span><br><span class="line">    default: the guest additions and repackage the box to continue.</span><br><span class="line">    default:</span><br><span class="line">    default: This is not an error message; everything may continue to work properly,</span><br><span class="line">    default: in which case you may ignore this message.</span><br><span class="line">==&gt; default: Configuring and enabling network interfaces...</span><br><span class="line">==&gt; default: Rsyncing folder: /cygdrive/c/Users/Administrator/ =&gt; /vagrant</span><br></pre></td></tr></table></figure></p>
<p>vagrant ssh 开启SSH，并登陆到centos7<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vagrant ssh</span></span><br><span class="line">[vagrant@localhost ~]$ ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:8a:fe:e6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic eth0</span><br><span class="line">       valid_lft 86091sec preferred_lft 86091sec</span><br><span class="line">    inet6 fe80::5054:ff:fe8a:fee6/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 08:00:27:d1:76:f6 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.56.102/24 brd 192.168.56.255 scope global noprefixroute dynamic eth1</span><br><span class="line">       valid_lft 892sec preferred_lft 892sec</span><br><span class="line">    inet6 fe80::8c94:1942:ba09:2458/64 scope link noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[vagrant@localhost ~]$</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;ipconfig</span><br><span class="line">Windows IP 配置</span><br><span class="line">以太网适配器 VirtualBox Host-Only Network:</span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::a00c:1ffa:a39a:c8c2%16</span><br><span class="line">   IPv4 地址 . . . . . . . . . . . . : 192.168.56.1</span><br><span class="line">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   默认网关. . . . . . . . . . . . . :</span><br></pre></td></tr></table></figure>
<p>配置网络信息，打开”Vagrantfile”文件：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">config</span><span class="selector-class">.vm</span><span class="selector-class">.network</span> "<span class="selector-tag">private_network</span>", <span class="selector-tag">ip</span>: "192<span class="selector-class">.168</span><span class="selector-class">.56</span><span class="selector-class">.10</span>"</span><br></pre></td></tr></table></figure></p>
<p>修改完成后，重启启动vagrant<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vagrant reload</span></span><br></pre></td></tr></table></figure></p>
<p>检查宿主机和virtualBox之间的通信是否正常<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@localhost ~]$<span class="built_in"> ping </span>192.168.43.43                                                                                                        <span class="built_in"> PING </span>192.168.43.43 (192.168.43.43) 56(84) bytes of data.</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.43.43: <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=127 <span class="attribute">time</span>=0.533 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 192.168.43.43: <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=127 <span class="attribute">time</span>=0.659 ms</span><br><span class="line"></span><br><span class="line">--- 192.168.43.43<span class="built_in"> ping </span>statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 999ms</span><br><span class="line">rtt min/avg/max/mdev = 0.533/0.596/0.659/0.063 ms</span><br><span class="line">[vagrant@localhost ~]$</span><br><span class="line">[vagrant@localhost ~]$</span><br><span class="line">[vagrant@localhost ~]$<span class="built_in"> ping </span>www.baidu.com</span><br><span class="line">PING www.a.shifen.com (112.80.248.76) 56(84) bytes of data.</span><br><span class="line">64 bytes <span class="keyword">from</span> 112.80.248.76 (112.80.248.76): <span class="attribute">icmp_seq</span>=1 <span class="attribute">ttl</span>=53 <span class="attribute">time</span>=56.1 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 112.80.248.76 (112.80.248.76): <span class="attribute">icmp_seq</span>=2 <span class="attribute">ttl</span>=53 <span class="attribute">time</span>=58.5 ms</span><br><span class="line">64 bytes <span class="keyword">from</span> 112.80.248.76 (112.80.248.76): <span class="attribute">icmp_seq</span>=3 <span class="attribute">ttl</span>=53 <span class="attribute">time</span>=53.4 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>开启远程登陆，修改“/etc/ssh/sshd_config”<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin yes </span><br><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure></p>
<p>然后重启SSHD<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure></p>
<p>使用Xshell或SecureCRT进行远程连接。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341333713-92cd61d6-11bf-49e3-ac5e-4f5c05bd20c2.png#align=left&amp;display=inline&amp;height=426&amp;margin=%5Bobject%20Object%5D&amp;originHeight=426&amp;originWidth=1247&amp;status=done&amp;style=none&amp;width=1247" alt></p>
<h2 id="2-docker中安装mysql"><a href="#2-docker中安装mysql" class="headerlink" title="2. docker中安装mysql"></a>2. docker中安装mysql</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop-104 module]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">123275d6e508: Already exists </span><br><span class="line">27cddf5c7140: Pull complete </span><br><span class="line">c17d442e14c9: Pull complete </span><br><span class="line">2eb72ffed068: Pull complete </span><br><span class="line">d4aa125eb616: Pull complete </span><br><span class="line">52560afb169c: Pull complete </span><br><span class="line">68190f37a1d2: Pull complete </span><br><span class="line">3fd1dc6e2990: Pull complete </span><br><span class="line">85a79b83df29: Pull complete </span><br><span class="line">35e0b437fe88: Pull complete </span><br><span class="line">992f6a10268c: Pull complete </span><br><span class="line">Digest: sha256:82b72085b2fcff073a6616b84c7c3bcbb36e2d13af838cec11a9ed1d0b183f5e</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></table></figure>
<p>查看镜像<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop-<span class="number">104</span> <span class="class"><span class="keyword">module</span>]<span class="comment"># docker images</span></span></span><br><span class="line">REPOSITORY  TAG    IMAGE ID     CREATED       SIZE</span><br><span class="line">mysql       <span class="number">5.7</span>    f5829c0eee9e <span class="number">2</span> hours ago   <span class="number">455</span>MB</span><br><span class="line">[root@hadoop-<span class="number">104</span> <span class="class"><span class="keyword">module</span>]<span class="comment">#</span></span></span><br></pre></td></tr></table></figure></p>
<p>启动mysql<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -p 3306:3306 --name mysql \</span><br><span class="line">-v /mydata/mysql/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql:5.7</span><br></pre></td></tr></table></figure></p>
<p>修改配置<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop-104 conf]# pwd</span><br><span class="line">/mydata/mysql/conf</span><br><span class="line">[root@hadoop-104 conf]# cat my.cnf</span><br><span class="line">[client]</span><br><span class="line"><span class="keyword">default</span>-character-set=utf8</span><br><span class="line">[mysql]</span><br><span class="line"><span class="keyword">default</span>-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">init_connect=<span class="string">'SET collation_connection = utf8_unicode_ci'</span></span><br><span class="line">init_connect=<span class="string">'SET NAMES utf8'</span></span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_unicode_ci</span><br><span class="line">skip-character-set-client-handshake</span><br><span class="line">skip-name-resolve</span><br><span class="line">[root@hadoop-104 conf]# </span><br><span class="line">[root@hadoop-104 conf]# docker restart mysql</span><br><span class="line">mysql</span><br><span class="line">[root@hadoop-104 conf]#</span><br></pre></td></tr></table></figure></p>
<p>进入容器查看配置：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop-104 conf]# docker exec -it mysql /bin/bash</span><br><span class="line">root@b3a74e031bd7:/# whereis mysql</span><br><span class="line">mysql: /usr/bin/mysql /usr/lib/mysql /etc/mysql /usr/share/mysql</span><br><span class="line">root@b3a74e031bd7:/# ls /etc/mysql </span><br><span class="line">my.cnf</span><br><span class="line">root@b3a74e031bd7:/# cat /etc/mysql/my.cnf </span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">init_connect='SET collation_connection = utf8_unicode_ci'</span><br><span class="line">init_connect='SET NAMES utf8'</span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_unicode_ci</span><br><span class="line">skip-character-set-client-handshake</span><br><span class="line">skip-name-resolve</span><br><span class="line">root@b3a74e031bd7:/#</span><br></pre></td></tr></table></figure></p>
<p>设置启动docker时，即运行mysql<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@hadoop</span><span class="number">-104</span> ~]<span class="meta"># docker update mysql --restart=always</span></span><br><span class="line">mysql</span><br><span class="line">[root<span class="symbol">@hadoop</span><span class="number">-104</span> ~]<span class="meta">#</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-docker中安装redis"><a href="#3-docker中安装redis" class="headerlink" title="3. docker中安装redis"></a>3. docker中安装redis</h2><p>下载docker<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop-104 ~]# docker pull redis</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/redis</span><br><span class="line">123275d6e508: Already exists </span><br><span class="line">f2edbd6a658e: Pull complete </span><br><span class="line">66960bede47c: Pull complete </span><br><span class="line">79dc0b596c90: Pull complete </span><br><span class="line">de36df38e0b6: Pull complete </span><br><span class="line">602cd484ff92: Pull complete </span><br><span class="line">Digest: sha256:1d0b903e3770c2c3c79961b73a53e963f4fd4b2674c2c4911472e8a054cb5728</span><br><span class="line">Status: Downloaded newer image for redis:latest</span><br><span class="line">docker.io/library/redis:latest</span><br></pre></td></tr></table></figure></p>
<p>启动docker<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop-104 ~]# mkdir -p /mydata/redis/conf</span><br><span class="line">[root@hadoop-104 ~]# touch /mydata/redis/conf/redis.conf</span><br><span class="line">[root@hadoop-104 ~]# echo "appendonly yes"  &gt;&gt; /mydata/redis/conf/redis.conf</span><br><span class="line">[root@hadoop-104 ~]# docker run -p 6379:6379 --name redis -v /mydata/redis/data:/data \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> -d redis redis-server /etc/redis/redis.conf</span></span><br><span class="line">ce7ae709711986e3f90c9278b284fe6f51f1c1102ba05f3692f0e934ceca1565</span><br><span class="line">[root@hadoop-104 ~]#</span><br></pre></td></tr></table></figure></p>
<p>连接到docker的redis<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop-104 ~]# docker exec -it redis redis-cli</span><br><span class="line">127.0.0.1:6379&gt; set key1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">"v1"</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure></p>
<p>设置redis容器在docker启动的时候启动<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop-104 ~]# docker update redis --restart=always</span><br><span class="line">redis</span><br><span class="line">[root@hadoop-104 ~]#</span><br></pre></td></tr></table></figure></p>
<h2 id="4-创建maven工程"><a href="#4-创建maven工程" class="headerlink" title="4. 创建maven工程"></a>4. 创建maven工程</h2><h2 id="5-执行sql脚本"><a href="#5-执行sql脚本" class="headerlink" title="5. 执行sql脚本"></a>5. 执行sql脚本</h2><p>gulimall_oms.sql<br>gulimall_pms.sql<br>gulimall_sms.sql<br>gulimall_ums.sql<br>gulimall_wms.sql<br>pms_catelog.sql<br>sys_menus.sql</p>
<h2 id="6-clone-人人开源"><a href="#6-clone-人人开源" class="headerlink" title="6. clone 人人开源"></a>6. clone 人人开源</h2><p><a href="https://gitee.com/renrenio" target="_blank" rel="noopener">https://gitee.com/renrenio</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341333815-30cb9aad-dc74-40d5-a629-4b904411837e.png#align=left&amp;display=inline&amp;height=699&amp;margin=%5Bobject%20Object%5D&amp;originHeight=699&amp;originWidth=1496&amp;status=done&amp;style=none&amp;width=1496" alt><br>克隆到本地：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https://gitee.com/renrenio/renren-fast-vue.git</span><br><span class="line">git clone https://gitee.com/renrenio/renren-fast.git</span><br></pre></td></tr></table></figure></p>
<p>将拷贝下来的“renren-fast”删除“.git”后，拷贝到“gulimall”工程根目录下，然后将它作为gulimall的一个module<br>创建“gulimall_admin”的数据库，然后执行“renren-fast/db/mysql.sql”中的SQl脚本<br>修改“application-dev.yml”文件，默认为dev环境，修改连接mysql的url和用户名密码<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">druid:</span></span><br><span class="line">            <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">            <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.137.14:3306/gulimall_admin?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">            <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">            <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure></p>
<p>启动“gulimall_admin”，然后访问“<a href="http://localhost:8080/renren-fast/" target="_blank" rel="noopener">http://localhost:8080/renren-fast/</a>”<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341333853-fda70664-7dae-4b2a-ac1d-14ee8983261c.png#align=left&amp;display=inline&amp;height=148&amp;margin=%5Bobject%20Object%5D&amp;originHeight=148&amp;originWidth=960&amp;status=done&amp;style=none&amp;width=960" alt><br>安装node.js，并且安装仓库<br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="keyword">set</span> <span class="keyword">registry</span> <span class="keyword">http</span>://<span class="keyword">registry</span>.npm.taobao.org/</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PS D:\tmp\renren-fast-vue&gt; npm config set registry http://registry.npm.taobao.org/</span><br><span class="line">PS D:\tmp\renren-fast-vue&gt; npm install</span><br><span class="line">npm WARN ajv-keywords@1.5.1 requires a peer of ajv@&gt;=4.10.0 but none is installed. You must install peer dependencies yourself.</span><br><span class="line">npm WARN sass-loader@6.0.6 requires a peer of node-sass@^4.0.0 but none is installed. You must install peer dependencies yourself.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.9 (node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.9: wanted &#123;"os":"darwin","arch":"any"&#125; (current: &#123;"os":"win32","arch":"x64"&#125;)</span><br><span class="line">up to date in 17.227s</span><br><span class="line">PS D:\tmp\renren-fast-vue&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PS D:\tmp\renren-fast-vue&gt; npm run dev</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> renren-fast-vue@1.2.2 dev D:\tmp\renren-fast-vue</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> webpack-dev-server --inline --progress --config build/webpack.dev.conf.js</span></span><br><span class="line"><span class="meta"> 10%</span><span class="bash"> building modules 5/10 modules 5 active ...-0!D:\tmp\renren-fast-vue\src\main.js(node:19864) Warning: Accessing non-existent property <span class="string">'cat'</span> of module exports inside circular dependency</span></span><br><span class="line">(Use `node --trace-warnings ...` to show where the warning was created)</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'cd' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'chmod' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'cp' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'dirs' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'pushd' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'popd' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'echo' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'tempdir' of module exports inside circular dependency</span><br><span class="line">(node:19864) Warning: Accessing non-existent property 'pwd' of module exports inside circular dependency</span><br></pre></td></tr></table></figure>
<p>常见问题1：“Module build failed: Error: Cannot find module ‘node-sass”<br>运行过程中，出现“Module build failed: Error: Cannot find module ‘node-sass’报错问题”，解决方法</p>
<blockquote>
<p>用npm install -g cnpm –registry=<a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a> ，从淘宝镜像那下载，然后cnpm下载成功。<br>最后输入cnpm install node-sass –save。npm run dev终于能跑起来了！！！<br>————————————————<br>版权声明：本文为CSDN博主「夕阳下美了剪影」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_38401285/article/details/86483278" target="_blank" rel="noopener">https://blog.csdn.net/qq_38401285/article/details/86483278</a></p>
</blockquote>
<p>常见问题2：cnpm - 解决 “ cnpm : 无法加载文件 C:\Users\93457\AppData\Roaming\npm\cnpm.ps1，因为在此系统上禁止运行脚本。有关详细信息 。。。 “<br><a href="https:_www.cnblogs.com_500m_p_11634969" target="_blank" rel="noopener">https://www.cnblogs.com/500m/p/11634969.html</a><br>所有问题的根源都在“node_modules”，npm install之前，应该将这个文件夹删除，然后再进行安装和运行。<br>再次运行npm run dev恢复正常：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341333906-58358fd8-ecbf-4c1a-b7ed-d681a1992eca.png#align=left&amp;display=inline&amp;height=472&amp;margin=%5Bobject%20Object%5D&amp;originHeight=472&amp;originWidth=1126&amp;status=done&amp;style=none&amp;width=1126" alt></p>
<h2 id="7-clone-renren-generator"><a href="#7-clone-renren-generator" class="headerlink" title="7. clone renren-generator"></a>7. clone renren-generator</h2><h3 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h3><p><a href="https://gitee.com/renrenio/renren-generator.git" target="_blank" rel="noopener">https://gitee.com/renrenio/renren-generator.git</a><br>然后将该项目放置到“gulimall”的跟路径下，然后添加该Module，并且提交到github上</p>
<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><p>renren-generator/src/main/resources/generator.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#代码生成器，配置信息</span><br><span class="line">mainPath=com.bigdata</span><br><span class="line">#包名</span><br><span class="line">package=com.bigdata.gulimall</span><br><span class="line">moduleName=product</span><br><span class="line">#作者</span><br><span class="line">author=cosmoswong</span><br><span class="line">#Email</span><br><span class="line">email=cosmoswong@sina.com</span><br><span class="line">#表前缀(类名不会包含表前缀)</span><br><span class="line">tablePrefix=pms_</span><br></pre></td></tr></table></figure></p>
<h3 id="运行“renren-generator”"><a href="#运行“renren-generator”" class="headerlink" title="运行“renren-generator”"></a>运行“renren-generator”</h3><p>访问：&lt;<a href="http://localhost:80/" target="_blank" rel="noopener">http://localhost:80/</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341333996-e604712d-5d9e-47d0-8655-8628906a3bcf.png#align=left&amp;display=inline&amp;height=454&amp;margin=%5Bobject%20Object%5D&amp;originHeight=454&amp;originWidth=1109&amp;status=done&amp;style=none&amp;width=1109" alt><br>点击“renren-fast”，能够看到它将“renren-fast”的所有表都列举了出来：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341334052-3d1f1838-6cee-44dc-a3ce-7bb58001f3f7.png#align=left&amp;display=inline&amp;height=676&amp;margin=%5Bobject%20Object%5D&amp;originHeight=676&amp;originWidth=1871&amp;status=done&amp;style=none&amp;width=1871" alt><br>选择所有的表，然后点击“生成代码”，将下载的“renren.zip”，解压后取出main文件夹，放置到“gulimall-product”项目的main目录中。<br>下面的几个module，也采用同样的方式来操作。<br>但是针对于“undo_log”，存在一个问题<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341334102-0cd6bb3a-107e-4b2d-a71c-aa5cfb827547.png#align=left&amp;display=inline&amp;height=343&amp;margin=%5Bobject%20Object%5D&amp;originHeight=343&amp;originWidth=915&amp;status=done&amp;style=none&amp;width=915" alt><br>它的数据类型是“longblob”类型，逆向工程后，对应的数据类型未知：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341334165-ad13d924-a507-4a36-8707-f944f180b99b.png#align=left&amp;display=inline&amp;height=110&amp;margin=%5Bobject%20Object%5D&amp;originHeight=110&amp;originWidth=834&amp;status=done&amp;style=none&amp;width=834" alt><br>这个问题该要怎么解决？</p>
<h2 id="8-微服务注册中心"><a href="#8-微服务注册中心" class="headerlink" title="8. 微服务注册中心"></a>8. 微服务注册中心</h2><p>要注意nacos集群所在的server，一定要关闭防火墙，否则容易出现各种问题。<br>搭建nacos集群，然后分别启动各个微服务，将它们注册到Nacos中。<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-coupon</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span></span><br></pre></td></tr></table></figure></p>
<p>查看注册情况：<br><a href="http://192.168.137.14:8848/nacos/#/serviceManagement?dataId=&amp;group=&amp;appName=&amp;namespace=" target="_blank" rel="noopener">http://192.168.137.14:8848/nacos/#/serviceManagement?dataId=&amp;group=&amp;appName=&amp;namespace=</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341334211-633298d6-1469-4a8e-9ca0-712bf437503f.png#align=left&amp;display=inline&amp;height=474&amp;margin=%5Bobject%20Object%5D&amp;originHeight=474&amp;originWidth=1357&amp;status=done&amp;style=none&amp;width=1357" alt></p>
<h2 id="9-使用openfen"><a href="#9-使用openfen" class="headerlink" title="9. 使用openfen"></a>9. 使用openfen</h2><p>1)、引入open-feign<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2)、编写一个接口，告诉SpringCLoud这个接口需要调用远程服务<br>修改“com.bigdata.gulimall.coupon.controller.CouponController”，添加以下controller方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/member/list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">memberCoupons</span><span class="params">()</span></span>&#123;</span><br><span class="line">        CouponEntity couponEntity = <span class="keyword">new</span> CouponEntity();</span><br><span class="line">        couponEntity.setCouponName(<span class="string">"discount 20%"</span>);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">"coupons"</span>,Arrays.asList(couponEntity));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>新建“com.bigdata.gulimall.member.feign.CouponFeignService”接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(<span class="string">"gulimall_coupon"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CouponFeignService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/coupon/coupon/member/list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">memberCoupons</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>修改“com.bigdata.gulimall.member.GulimallMemberApplication”类，添加上”@EnableFeignClients”：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span>(basePackages = <span class="string">"com.bigdata.gulimall.member.feign"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallMemberApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(GulimallMemberApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>声明接口的每一个方法都是调用哪个远程服务的那个请求
</code></pre><p>3)、开启远程调用功能<br>com.bigdata.gulimall.member.controller.MemberController<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/coupons"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        MemberEntity memberEntity=<span class="keyword">new</span> MemberEntity();</span><br><span class="line">        memberEntity.setNickname(<span class="string">"zhangsan"</span>);</span><br><span class="line">        R memberCoupons = couponFeignService.memberCoupons();</span><br><span class="line">        <span class="keyword">return</span> memberCoupons.put(<span class="string">"member"</span>,memberEntity).put(<span class="string">"coupons"</span>,memberCoupons.get(<span class="string">"coupons"</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>(4)、访问<a href="http://localhost:8000/member/member/coupons" target="_blank" rel="noopener">http://localhost:8000/member/member/coupons</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341334279-1282e3ff-1786-4648-8dff-8dd7672bb341.png#align=left&amp;display=inline&amp;height=200&amp;margin=%5Bobject%20Object%5D&amp;originHeight=200&amp;originWidth=1212&amp;status=done&amp;style=none&amp;width=1212" alt><br>停止“gulimall-coupon”服务，能够看到注册中心显示该服务的健康值为0：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341334391-bcd0cc89-fcfc-4640-923f-d97ecaf454ba.png#align=left&amp;display=inline&amp;height=415&amp;margin=%5Bobject%20Object%5D&amp;originHeight=415&amp;originWidth=1409&amp;status=done&amp;style=none&amp;width=1409" alt><br>再次访问：<a href="http://localhost:8000/member/member/coupons" target="_blank" rel="noopener">http://localhost:8000/member/member/coupons</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341334471-334ddb93-08aa-4d86-ab4e-22619d03f367.png#align=left&amp;display=inline&amp;height=266&amp;margin=%5Bobject%20Object%5D&amp;originHeight=266&amp;originWidth=1098&amp;status=done&amp;style=none&amp;width=1098" alt><br>启动“gulimall-coupon”服务，再次访问，又恢复了正常。</p>
<h2 id="10-配置中心"><a href="#10-配置中心" class="headerlink" title="10. 配置中心"></a>10. 配置中心</h2><h3 id="1）修改“gulimall-coupon”模块"><a href="#1）修改“gulimall-coupon”模块" class="headerlink" title="1）修改“gulimall-coupon”模块"></a>1）修改“gulimall-coupon”模块</h3><p>添加pom依赖：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>创建bootstrap.properties文件，该配置文件会优先于“application.yml”加载。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=gulimall-coupon</span><br><span class="line">spring.cloud.nacos.config.server-addr=192.168.137.14:8848</span><br></pre></td></tr></table></figure></p>
<h3 id="2）传统方式"><a href="#2）传统方式" class="headerlink" title="2）传统方式"></a>2）传统方式</h3><p>为了详细说明config的使用方法，先来看原始的方式<br>创建“application.properties”配置文件，添加如下配置内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">coupon.user.name=&quot;zhangsan&quot;</span><br><span class="line">coupon.user.age=30</span><br></pre></td></tr></table></figure></p>
<p>修改“com.bigdata.gulimall.coupon.controller.CouponController”文件，添加如下内容：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;coupon.user.name&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;coupon.user.age&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getConfigInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> R.ok().put(<span class="string">"name"</span>,name).put(<span class="string">"age"</span>,age);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>启动“gulimall-coupon”服务：<br>访问：<a href="http://localhost:7000/coupon/coupon/test" target="_blank" rel="noopener">http://localhost:7000/coupon/coupon/test</a>&gt;<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341334525-d99419de-8f9e-4fc4-ba71-f976e1b6cff7.png#align=left&amp;display=inline&amp;height=107&amp;margin=%5Bobject%20Object%5D&amp;originHeight=107&amp;originWidth=1075&amp;status=done&amp;style=none&amp;width=1075" alt><br>这样做存在的一个问题，如果频繁的修改application.properties，在需要频繁重新打包部署。下面我们将采用Nacos的配置中心来解决这个问题。</p>
<h3 id="3）nacos-config"><a href="#3）nacos-config" class="headerlink" title="3）nacos config"></a>3）nacos config</h3><p>1、在Nacos注册中心中，点击“配置列表”，添加配置规则：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341334664-acd21bce-cd02-4ba3-914a-37ed05c13e28.png#align=left&amp;display=inline&amp;height=812&amp;margin=%5Bobject%20Object%5D&amp;originHeight=812&amp;originWidth=1860&amp;status=done&amp;style=none&amp;width=1860" alt><br>DataID：gulimall-coupon<br>配置格式：properties<br>文件的命名规则为：${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}<br>${spring.application.name}：为微服务名<br>${spring.profiles.active}：指明是哪种环境下的配置，如dev、test或info<br>${spring.cloud.nacos.config.file-extension}：配置文件的扩展名，可以为properties、yml等<br>2、查看配置：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341334718-852ebc2d-d8d6-4b92-859e-af2d382ed8c6.png#align=left&amp;display=inline&amp;height=417&amp;margin=%5Bobject%20Object%5D&amp;originHeight=417&amp;originWidth=1895&amp;status=done&amp;style=none&amp;width=1895" alt><br>3、修改“com.bigdata.gulimall.coupon.controller.CouponController”类，添加“@RefreshScope”注解<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"coupon/coupon"</span>)</span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CouponController</span> </span>&#123;</span><br></pre></td></tr></table></figure></p>
<p>这样都会动态的从配置中心读取配置.<br>4、访问：<a href="http://localhost:7000/coupon/coupon/test" target="_blank" rel="noopener">http://localhost:7000/coupon/coupon/test</a><br><img src="images/1587717485283.png#" alt><br>能够看到读取到了nacos 中的最新的配置信息，并且在指明了相同的配置信息时，配置中心中设置的值优先于本地配置。</p>
<h3 id="4）Nacos支持三种配置加载方方案"><a href="#4）Nacos支持三种配置加载方方案" class="headerlink" title="4）Nacos支持三种配置加载方方案"></a>4）Nacos支持三种配置加载方方案</h3><p>Nacos支持“Namespace+group+data ID”的配置解决方案。<br>详情见：<a href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-docs/src/main/asciidoc-zh/nacos-config.adoc" target="_blank" rel="noopener">https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-docs/src/main/asciidoc-zh/nacos-config.adoc</a></p>
<h5 id="Namespace方案"><a href="#Namespace方案" class="headerlink" title="Namespace方案"></a>Namespace方案</h5><p>通过命名空间实现环境区分<br>下面是配置实例：<br>1、创建命名空间：<br>“命名空间”—&gt;“创建命名空间”：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335079-5d52d0ea-d056-4a17-8ede-90a5088b5a6d.png#align=left&amp;display=inline&amp;height=491&amp;margin=%5Bobject%20Object%5D&amp;originHeight=491&amp;originWidth=1893&amp;status=done&amp;style=none&amp;width=1893" alt><br>创建三个命名空间，分别为dev，test和prop<br>2、回到配置列表中，能够看到所创建的三个命名空间<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335321-216d5d0d-00bf-4a91-a2c3-cbd40e8fab1c.png#align=left&amp;display=inline&amp;height=510&amp;margin=%5Bobject%20Object%5D&amp;originHeight=510&amp;originWidth=1428&amp;status=done&amp;style=none&amp;width=1428" alt><br>下面我们需要在dev命名空间下，创建“gulimall-coupon.properties”配置规则：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335486-b417de91-7ff8-47dc-8f25-9f6d13437826.png#align=left&amp;display=inline&amp;height=803&amp;margin=%5Bobject%20Object%5D&amp;originHeight=803&amp;originWidth=1675&amp;status=done&amp;style=none&amp;width=1675" alt><br>3、访问：<a href="http://localhost:7000/coupon/coupon/test" target="_blank" rel="noopener">http://localhost:7000/coupon/coupon/test</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335537-b1430ffe-6774-49a7-88b5-faf335a28077.png#align=left&amp;display=inline&amp;height=100&amp;margin=%5Bobject%20Object%5D&amp;originHeight=100&amp;originWidth=826&amp;status=done&amp;style=none&amp;width=826" alt><br>并没有使用我们在dev命名空间下所配置的规则，而是使用的是public命名空间下所配置的规则，这是怎么回事呢？<br>查看“gulimall-coupon”服务的启动日志：<br><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">04</span>-<span class="number">24</span> <span class="number">16</span>:<span class="number">37</span>:<span class="number">24</span><span class="variable">.158</span>  WARN <span class="number">32792</span> --- [           main] c<span class="variable">.a</span><span class="variable">.c</span><span class="variable">.n</span><span class="variable">.c</span><span class="variable">.NacosPropertySourceBuilder</span>     : Ignore the empty nacos configuration <span class="keyword">and</span> get it based on dataId[gulimall-coupon] &amp; group[DEFAULT_GROUP]</span><br><span class="line"><span class="number">2020</span>-<span class="number">04</span>-<span class="number">24</span> <span class="number">16</span>:<span class="number">37</span>:<span class="number">24</span><span class="variable">.163</span>  INFO <span class="number">32792</span> --- [           main] c<span class="variable">.a</span><span class="variable">.nacos</span><span class="variable">.client</span><span class="variable">.config</span><span class="variable">.utils</span><span class="variable">.JVMUtil</span>    : isMultiInstance:false</span><br><span class="line"><span class="number">2020</span>-<span class="number">04</span>-<span class="number">24</span> <span class="number">16</span>:<span class="number">37</span>:<span class="number">24</span><span class="variable">.169</span>  INFO <span class="number">32792</span> --- [           main] b<span class="variable">.c</span><span class="variable">.PropertySourceBootstrapConfiguration</span> : Located <span class="keyword">property</span> source: [BootstrapPropertySource &#123;name='bootstrapProperties-gulimall-coupon<span class="variable">.properties</span>,DEFAULT_GROUP'&#125;, BootstrapPropertySource &#123;name='bootstrapProperties-gulimall-coupon,DEFAULT_GROUP'&#125;]</span><br></pre></td></tr></table></figure></p>
<p><strong>“gulimall-coupon.properties”</strong>，默认就是public命名空间中的内容中所配置的规则。<br>4、指定命名空间<br>如果想要使得我们自定义的命名空间生效，需要在“bootstrap.properties”文件中，指定使用哪个命名空间：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.config.namespace=a2c83f0b-e0a8-40fb-9b26-1e9d61be7d6d</span><br></pre></td></tr></table></figure></p>
<p>这个命名空间ID来源于我们在第一步所创建的命名空间<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335079-5d52d0ea-d056-4a17-8ede-90a5088b5a6d.png#align=left&amp;display=inline&amp;height=491&amp;margin=%5Bobject%20Object%5D&amp;originHeight=491&amp;originWidth=1893&amp;status=done&amp;style=none&amp;width=1893" alt><br>5、重启“gulimall-coupon”，再次访问：<a href="http://localhost:7000/coupon/coupon/test" target="_blank" rel="noopener">http://localhost:7000/coupon/coupon/test</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335617-b63a70a6-a480-476f-9b32-a68b9f37e820.png#align=left&amp;display=inline&amp;height=112&amp;margin=%5Bobject%20Object%5D&amp;originHeight=112&amp;originWidth=835&amp;status=done&amp;style=none&amp;width=835" alt><br>但是这种命名空间的粒度还是不够细化，对此我们可以为项目的每个微服务module创建一个命名空间。<br>6、为所有微服务创建命名空间<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335674-b777dc97-d760-4ff1-8dbd-1ab98020e6a8.png#align=left&amp;display=inline&amp;height=526&amp;margin=%5Bobject%20Object%5D&amp;originHeight=526&amp;originWidth=1531&amp;status=done&amp;style=none&amp;width=1531" alt><br>7、回到配置列表选项卡，克隆pulic的配置规则到coupon命名空间下<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335730-ba87b737-4b17-4fa8-b88c-7992a16d767a.png#align=left&amp;display=inline&amp;height=623&amp;margin=%5Bobject%20Object%5D&amp;originHeight=623&amp;originWidth=1346&amp;status=done&amp;style=none&amp;width=1346" alt><br>切换到coupon命名空间下，查看所克隆的规则：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335790-48fdcc9a-7b7e-4920-b143-a2c0f9882818.png#align=left&amp;display=inline&amp;height=237&amp;margin=%5Bobject%20Object%5D&amp;originHeight=237&amp;originWidth=1405&amp;status=done&amp;style=none&amp;width=1405" alt><br>8、修改“gulimall-coupon”下的bootstrap.properties文件，添加如下配置信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.config.namespace=7905c915-64ad-4066-8ea9-ef63918e5f79</span><br></pre></td></tr></table></figure></p>
<p>这里指明的是，读取时使用coupon命名空间下的配置。<br>9、重启“gulimall-coupon”，访问：<a href="http://localhost:7000/coupon/coupon/test" target="_blank" rel="noopener">http://localhost:7000/coupon/coupon/test</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335537-b1430ffe-6774-49a7-88b5-faf335a28077.png#align=left&amp;display=inline&amp;height=100&amp;margin=%5Bobject%20Object%5D&amp;originHeight=100&amp;originWidth=826&amp;status=done&amp;style=none&amp;width=826" alt></p>
<h5 id="DataID方案"><a href="#DataID方案" class="headerlink" title="DataID方案"></a>DataID方案</h5><p>通过指定spring.profile.active和配置文件的DataID，来使不同环境下读取不同的配置，读取配置时，使用的是默认命名空间public，默认分组（default_group）下的DataID。<br>默认情况，Namespace=public，Group=DEFAULT GROUP，默认Cluster是DEFAULT</p>
<h5 id="Group方案"><a href="#Group方案" class="headerlink" title="Group方案"></a>Group方案</h5><p>通过Group实现环境区分<br>实例：通过使用不同的组，来读取不同的配置，还是以上面的gulimall-coupon微服务为例<br>1、新建“gulimall-coupon.properties”，将它置于“tmp”组下<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335839-7036037e-fec0-4ab1-82a4-f79243ba3dce.png#align=left&amp;display=inline&amp;height=391&amp;margin=%5Bobject%20Object%5D&amp;originHeight=391&amp;originWidth=1495&amp;status=done&amp;style=none&amp;width=1495" alt><br>2、修改“bootstrap.properties”配置，添加如下的配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.config.group=tmp</span><br></pre></td></tr></table></figure></p>
<p>3、重启“gulimall-coupon”，访问：<a href="http://localhost:7000/coupon/coupon/test" target="_blank" rel="noopener">http://localhost:7000/coupon/coupon/test</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335925-e5c4bfc7-e3e6-48e3-a004-92849180f1b4.png#align=left&amp;display=inline&amp;height=119&amp;margin=%5Bobject%20Object%5D&amp;originHeight=119&amp;originWidth=861&amp;status=done&amp;style=none&amp;width=861" alt></p>
<h3 id="5）同时加载多个配置集"><a href="#5）同时加载多个配置集" class="headerlink" title="5）同时加载多个配置集"></a>5）同时加载多个配置集</h3><p>当微服务数量很庞大时，将所有配置都书写到一个配置文件中，显然不是太合适。对此我们可以将配置按照功能的不同，拆分为不同的配置文件。<br>如下面的配置文件：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#MySQL配置</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.137.14:3306/gulimall_sms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-coupon</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span><span class="string">:8848</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br></pre></td></tr></table></figure></p>
<p>我们可以将，<br>数据源有关的配置写到一个配置文件中：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#MySQL配置</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.137.14:3306/gulimall_sms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure></p>
<p>和框架有关的写到另外一个配置文件中：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br></pre></td></tr></table></figure></p>
<p>也可以将上面的这些配置交给nacos来进行管理。<br>实例：将“gulimall-coupon”的“application.yml”文件拆分为多个配置，并放置到nacos配置中心<br>1、创建“datasource.yml”，用于存储和数据源有关的配置<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#MySQL配置</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.137.14:3306/gulimall_sms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure></p>
<p>在coupon命名空间中，创建“datasource.yml”配置<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341335996-b5b189e4-476f-4f95-87f7-a93cfa7ac719.png#align=left&amp;display=inline&amp;height=517&amp;margin=%5Bobject%20Object%5D&amp;originHeight=517&amp;originWidth=1489&amp;status=done&amp;style=none&amp;width=1489" alt><br>2、将和mybatis相关的配置，放置到“mybatis.yml”中<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336048-7a0da1d7-6471-4c3f-92b0-1e9eeac74ee3.png#align=left&amp;display=inline&amp;height=492&amp;margin=%5Bobject%20Object%5D&amp;originHeight=492&amp;originWidth=1550&amp;status=done&amp;style=none&amp;width=1550" alt><br>3、创建“other.yml”配置，保存其他的配置信息<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-coupon</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span><span class="string">:8848</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336191-fb57d7c9-e04a-47f4-ae11-ede17c904a0f.png#align=left&amp;display=inline&amp;height=590&amp;margin=%5Bobject%20Object%5D&amp;originHeight=590&amp;originWidth=1124&amp;status=done&amp;style=none&amp;width=1124" alt><br>现在“mybatis.yml”、“datasource.yml”和“other.yml”共同构成了微服务的配置。<br>4、修改“gulimall-coupon”的“bootstrap.properties”文件，加载“mybatis.yml”、“datasource.yml”和“other.yml”配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.config.extension-configs[0].data-id=mybatis.yml</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].group=dev</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].refresh=true</span><br><span class="line">spring.cloud.nacos.config.extension-configs[1].data-id=datasource.yml</span><br><span class="line">spring.cloud.nacos.config.extension-configs[1].group=dev</span><br><span class="line">spring.cloud.nacos.config.extension-configs[1].refresh=true</span><br><span class="line">spring.cloud.nacos.config.extension-configs[2].data-id=other.yml</span><br><span class="line">spring.cloud.nacos.config.extension-configs[2].group=dev</span><br><span class="line">spring.cloud.nacos.config.extension-configs[2].refresh=true</span><br></pre></td></tr></table></figure></p>
<p>“spring.cloud.nacos.config.ext-config”已经被废弃，建议使用“spring.cloud.nacos.config.extension-configs”<br>5、注释“application.yml”文件中的所有配置<br>6、重启“gulimall-coupon”服务，然后访问：<a href="http://localhost:7000/coupon/coupon/test" target="_blank" rel="noopener">http://localhost:7000/coupon/coupon/test</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336268-57e7b7bb-fda3-4454-8171-dac7d36c368a.png#align=left&amp;display=inline&amp;height=96&amp;margin=%5Bobject%20Object%5D&amp;originHeight=96&amp;originWidth=982&amp;status=done&amp;style=none&amp;width=982" alt><br>7、访问：<a href="http://localhost:7000/coupon/coupon/list" target="_blank" rel="noopener">http://localhost:7000/coupon/coupon/list</a>，查看是否能够正常的访问数据库<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336356-bbfefde8-56dc-48f1-b70c-2065d7c56b9c.png#align=left&amp;display=inline&amp;height=91&amp;margin=%5Bobject%20Object%5D&amp;originHeight=91&amp;originWidth=1067&amp;status=done&amp;style=none&amp;width=1067" alt><br>小结：<br>1)、微服务任何配置信息，任何配置文件都可以放在配置中心；<br>2)、只需要在bootstrap.properties中，说明加载配置中心的哪些配置文件即可；<br>3)、@Value, @ConfigurationProperties。都可以用来获取配置中心中所配置的信息；<br>4)、配置中心有的优先使用配置中心中的，没有则使用本地的配置。</p>
<h2 id="11-网关"><a href="#11-网关" class="headerlink" title="11. 网关"></a>11. 网关</h2><h3 id="1、注册“gulimall-gateway”到Nacos"><a href="#1、注册“gulimall-gateway”到Nacos" class="headerlink" title="1、注册“gulimall-gateway”到Nacos"></a>1、注册“gulimall-gateway”到Nacos</h3><h4 id="1）创建“gulimall-gateway”"><a href="#1）创建“gulimall-gateway”" class="headerlink" title="1）创建“gulimall-gateway”"></a>1）创建“gulimall-gateway”</h4><p>SpringCloud gateway</p>
<h4 id="2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖"><a href="#2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖" class="headerlink" title="2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖"></a>2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.bigdata.gulimall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gulimall-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3）“com-bigdata-gulimall-gulimallgateway-GulimallGatewayApplication”类上加上“-EnableDiscoveryClient”注解"><a href="#3）“com-bigdata-gulimall-gulimallgateway-GulimallGatewayApplication”类上加上“-EnableDiscoveryClient”注解" class="headerlink" title="3）“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”类上加上“@EnableDiscoveryClient”注解"></a>3）“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”类上加上“@EnableDiscoveryClient”注解</h4><h4 id="4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway-yml”"><a href="#4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway-yml”" class="headerlink" title="4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway.yml”"></a>4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway.yml”</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336396-2a2b55c0-c72b-4cce-8b2c-bca25ef96500.png#align=left&amp;display=inline&amp;height=443&amp;margin=%5Bobject%20Object%5D&amp;originHeight=443&amp;originWidth=938&amp;status=done&amp;style=none&amp;width=938" alt></p>
<h4 id="5）创建“bootstrap-properties”文件，添加如下配置，指明配置中心地址和所属命名空间"><a href="#5）创建“bootstrap-properties”文件，添加如下配置，指明配置中心地址和所属命名空间" class="headerlink" title="5）创建“bootstrap.properties”文件，添加如下配置，指明配置中心地址和所属命名空间"></a>5）创建“bootstrap.properties”文件，添加如下配置，指明配置中心地址和所属命名空间</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=gulimall-gateway</span><br><span class="line">spring.cloud.nacos.config.server-addr=192.168.137.14:8848</span><br><span class="line">spring.cloud.nacos.config.namespace=1c82552e-1af0-4ced-9a48-26f19c2d315f</span><br></pre></td></tr></table></figure>
<h4 id="6）创建“application-properties”文件，指定服务名和注册中心地址"><a href="#6）创建“application-properties”文件，指定服务名和注册中心地址" class="headerlink" title="6）创建“application.properties”文件，指定服务名和注册中心地址"></a>6）创建“application.properties”文件，指定服务名和注册中心地址</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=gulimall-gateway</span><br><span class="line">spring.cloud.nacos.discovery.server-addr=192.168.137.14:8848</span><br><span class="line">server.port=88</span><br></pre></td></tr></table></figure>
<h4 id="7）启动“gulimall-gateway”"><a href="#7）启动“gulimall-gateway”" class="headerlink" title="7）启动“gulimall-gateway”"></a>7）启动“gulimall-gateway”</h4><p>启动报错：<br><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Description:</span><br><span class="line">Failed to configure a DataSource: 'url' attribute is <span class="keyword">not</span> specified <span class="keyword">and</span> no embedded datasource could be configured.</span><br><span class="line">Reason: Failed to determine a suitable driver <span class="keyword">class</span></span><br></pre></td></tr></table></figure></p>
<p>解决方法：在“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”中排除和数据源相关的配置<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span>(exclude = &#123;DataSourceAutoConfiguration<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br></pre></td></tr></table></figure></p>
<p>重新启动<br>访问：<a href="http://192.168.137.14:8848/nacos/#" target="_blank" rel="noopener">http://192.168.137.14:8848/nacos/#</a>，查看到该服务已经注册到了Nacos中<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336468-aeb1773d-4601-4f14-8a17-d8c1c088c7ef.png#align=left&amp;display=inline&amp;height=510&amp;margin=%5Bobject%20Object%5D&amp;originHeight=510&amp;originWidth=1238&amp;status=done&amp;style=none&amp;width=1238" alt></p>
<h3 id="2、案例"><a href="#2、案例" class="headerlink" title="2、案例"></a>2、案例</h3><p>现在想要实现针对于“<a href="http://localhost:88/hello?url=baidu”，转发到“[https://www.baidu.com](https://www.baidu.com)”，针对于“http://localhost:88/hello?url=qq”的请求，转发到“[https://www.qq.com/](https://www.qq.com/)”" target="_blank" rel="noopener">http://localhost:88/hello?url=baidu”，转发到“[https://www.baidu.com](https://www.baidu.com)”，针对于“http://localhost:88/hello?url=qq”的请求，转发到“[https://www.qq.com/](https://www.qq.com/)”</a></p>
<h4 id="1）创建“application-yml”"><a href="#1）创建“application-yml”" class="headerlink" title="1）创建“application.yml”"></a>1）创建“application.yml”</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">baidu_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.baidu.com</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,</span> <span class="string">baidu</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">qq_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://www.qq.com/</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Query=url,</span> <span class="string">qq</span></span><br></pre></td></tr></table></figure>
<h4 id="2）启动“gulimall-gateway”"><a href="#2）启动“gulimall-gateway”" class="headerlink" title="2）启动“gulimall-gateway”"></a>2）启动“gulimall-gateway”</h4><h4 id="3）测试"><a href="#3）测试" class="headerlink" title="3）测试"></a>3）测试</h4><p>访问：<a href="http://localhost:88/hello?url=baidu" target="_blank" rel="noopener">http://localhost:88/hello?url=baidu</a><br>访问：<a href="http://localhost:88/hello?url=qq" target="_blank" rel="noopener">http://localhost:88/hello?url=qq</a></p>
<h2 id="12-Vue"><a href="#12-Vue" class="headerlink" title="12. Vue"></a>12. Vue</h2><p>安装vue<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 最新稳定版</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install vue</span></span><br></pre></td></tr></table></figure></p>
<h3 id="1、vue声明式渲染"><a href="#1、vue声明式渲染" class="headerlink" title="1、vue声明式渲染"></a>1、vue声明式渲染</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">            el: <span class="string">"#app"</span>,<span class="comment">//绑定元素</span></span><br><span class="line">            data: &#123;  <span class="comment">//封装数据</span></span><br><span class="line">                name: <span class="string">"张三"</span>,</span><br><span class="line">                num: <span class="number">1</span></span><br><span class="line">            &#125;,</span><br><span class="line">            methods:&#123;  <span class="comment">//封装方法</span></span><br><span class="line">                cancle()&#123;</span><br><span class="line">                    <span class="keyword">this</span>.num -- ;</span><br><span class="line">                &#125;,</span><br><span class="line">                hello()&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"1"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="2、双向绑定-模型变化，视图变化。反之亦然"><a href="#2、双向绑定-模型变化，视图变化。反之亦然" class="headerlink" title="2、双向绑定,模型变化，视图变化。反之亦然"></a>2、双向绑定,模型变化，视图变化。反之亦然</h3><p>双向绑定使用v-model<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"num"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt; &#123;&#123;name&#125;&#125; ,非常帅，有&#123;&#123;num&#125;&#125;个人为他点赞&#123;&#123;hello()&#125;&#125;&lt;<span class="regexp">/h1&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336511-123c9554-c658-4584-a71f-f2a33a42861a.png#align=left&amp;display=inline&amp;height=622&amp;margin=%5Bobject%20Object%5D&amp;originHeight=622&amp;originWidth=937&amp;status=done&amp;style=none&amp;width=937" alt></p>
<h3 id="3、事件处理"><a href="#3、事件处理" class="headerlink" title="3、事件处理"></a>3、事件处理</h3><p>v-xx：指令<br>1、创建vue实例，关联页面的模板，将自己的数据（data）渲染到关联的模板，响应式的<br>2、指令来简化对dom的一些操作。<br>3、声明方法来做更复杂的操作。methods里面可以封装方法。<br>v-on是按钮的单击事件：<br><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">button</span> v-<span class="keyword">on</span>:click=<span class="string">"num++"</span>&gt;点赞&lt;/<span class="keyword">button</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>在VUE中el,data和vue的作用:</p>
<ul>
<li>el：用来绑定数据；</li>
<li>data:用来封装数据；</li>
<li>methods：用来封装方法，并且能够封装多个方法，如何上面封装了cancell和hello方法。</li>
</ul>
<p>安装“Vue 2 Snippets”，用来做代码提示<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336558-5894d3c5-0be5-4a4e-869c-83371c90bf59.png#align=left&amp;display=inline&amp;height=405&amp;margin=%5Bobject%20Object%5D&amp;originHeight=405&amp;originWidth=732&amp;status=done&amp;style=none&amp;width=732" alt><br>为了方便的在浏览器上调试VUE程序，需要安装“<a href="https://github.com/vuejs/vue-devtools" target="_blank" rel="noopener">vue-devtools</a>”，编译后安装到chrome中即可。<br>详细的使用方法见：<a href="https://www.jianshu.com/p/63f09651724c" target="_blank" rel="noopener">Vue调试神器vue-devtools安装</a><br>“v-html”不会对于HTML标签进行转义，而是直接在浏览器上显示data所设置的内容;而“ v-text”会对html标签进行转义<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">        &#123;&#123;msg&#125;&#125;  &#123;&#123;<span class="number">1</span>+<span class="number">1</span>&#125;&#125;  &#123;&#123;hello()&#125;&#125;&lt;br/&gt;</span><br><span class="line">        &lt;span v-html=<span class="string">"msg"</span>&gt;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;br/</span>&gt;</span><br><span class="line">        &lt;span v-text=<span class="string">"msg"</span>&gt;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">   </span><br><span class="line">    &lt;script src=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script&gt;</span></span><br><span class="line"><span class="regexp">        new Vue(&#123;</span></span><br><span class="line"><span class="regexp">            el:"#app",</span></span><br><span class="line"><span class="regexp">            data:&#123;</span></span><br><span class="line"><span class="regexp">                msg:"&lt;h1&gt;Hello&lt;/</span>h1&gt;<span class="string">",</span></span><br><span class="line"><span class="string">                link:"</span>http:<span class="comment">//www.baidu.com"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            methods:&#123;</span><br><span class="line">                hello()&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"World"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336611-81c8fc8b-662a-4bd7-be1a-0e3f97a51275.png#align=left&amp;display=inline&amp;height=239&amp;margin=%5Bobject%20Object%5D&amp;originHeight=239&amp;originWidth=827&amp;status=done&amp;style=none&amp;width=827" alt><br>  :称为差值表达式，它必须要写在Html表达式，可以完成数学运算和方法调用</p>
<h3 id="4、v-bind-单向绑定"><a href="#4、v-bind-单向绑定" class="headerlink" title="4、v-bind :单向绑定"></a>4、v-bind :单向绑定</h3><p>给html标签的属性绑定<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 给html标签的属性绑定 --&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt; </span><br><span class="line">        &lt;a v-bind:href=<span class="string">"link"</span>&gt;gogogo&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">        &lt;!-- class,style  &#123;class名：加上？&#125;--&gt;</span></span><br><span class="line"><span class="regexp">        &lt;span v-bind:class="&#123;active:isActive,'text-danger':hasError&#125;"</span></span><br><span class="line"><span class="regexp">          :style="&#123;color: color1,fontSize: size&#125;"&gt;你好&lt;/</span>span&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script src="../</span>node_modules/vue/dist/vue.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;script&gt;</span></span><br><span class="line"><span class="string">        let vm = new Vue(&#123;</span></span><br><span class="line">            el:"#app",</span><br><span class="line">            data:&#123;</span><br><span class="line">                link: <span class="string">"http://www.baidu.com"</span>,</span><br><span class="line">                isActive:<span class="literal">true</span>,</span><br><span class="line">                hasError:<span class="literal">true</span>,</span><br><span class="line">                color1:<span class="string">'red'</span>,</span><br><span class="line">                size:<span class="string">'36px'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>上面所完成的任务就是给a标签绑定一个超链接。并且当“isActive”和“hasError”都是true的时候，将属性动态的绑定到，则绑定该“active”和 “text-danger”class。这样可以动态的调整属性的存在。<br>而且如果想要实现修改vm的”color1”和“size”， span元素的style也能够随之变化，则可以写作v-bind:style，也可以省略v-bind。</p>
<h3 id="5、v-model双向绑定"><a href="#5、v-model双向绑定" class="headerlink" title="5、v-model双向绑定"></a>5、v-model双向绑定</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 表单项，自定义组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        精通的语言：</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">v-model</span>=<span class="string">"language"</span> <span class="attr">value</span>=<span class="string">"Java"</span>&gt;</span> java<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">v-model</span>=<span class="string">"language"</span> <span class="attr">value</span>=<span class="string">"PHP"</span>&gt;</span> PHP<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">v-model</span>=<span class="string">"language"</span> <span class="attr">value</span>=<span class="string">"Python"</span>&gt;</span> Python<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 选中了 &#123;&#123;language.join(",")&#125;&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">            el:<span class="string">"#app"</span>,</span></span><br><span class="line">            data:&#123;</span><br><span class="line">                language: []</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面完成的功能就是通过“v-model”为输入框绑定多个值，能够实现选中的值，在data的language也在不断的发生着变化，<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336669-930174cb-e1b3-4996-8ba4-ba5340c6ba4c.png#align=left&amp;display=inline&amp;height=469&amp;margin=%5Bobject%20Object%5D&amp;originHeight=469&amp;originWidth=1235&amp;status=done&amp;style=none&amp;width=1235" alt><br>如果在控制台上指定vm.language=[“Java”,”PHP”]，则data值也会跟着变化。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336713-2ed083bf-a664-4dad-8d52-7709411acd0b.png#align=left&amp;display=inline&amp;height=800&amp;margin=%5Bobject%20Object%5D&amp;originHeight=800&amp;originWidth=1401&amp;status=done&amp;style=none&amp;width=1401" alt><br>通过“v-model”实现了页面发生了变化，则数据也发生变化，数据发生变化，则页面也发生变化，这样就实现了双向绑定。<br>数组的连接操作： 选中了 {<br>    <!-- {language.join(",")}} --></p>
<h3 id="6、v-on为按钮绑定事件"><a href="#6、v-on为按钮绑定事件" class="headerlink" title="6、v-on为按钮绑定事件"></a>6、v-on为按钮绑定事件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--事件中直接写js片段--&gt;</span><br><span class="line">        &lt;button v-on:click=<span class="string">"num++"</span>&gt;点赞&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;!--事件指定一个回调函数，必须是Vue实例中定义的函数--&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button @click="cancle"&gt;取消&lt;/</span>button&gt;</span><br></pre></td></tr></table></figure>
<p>上面是为两个按钮绑定了单击事件，其中一个对于num进行自增，另外一个自减。<br>v-on:click也可以写作<a href="https://www.yuque.com/click" target="_blank" rel="noopener">_@_click </a><br>事件的冒泡：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 事件修饰符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border: 1px solid red;padding: 20px;"</span> <span class="attr">v-on:click</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">            大div</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border: 1px solid blue;padding: 20px;"</span> @<span class="attr">click</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">                小div </span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span> @<span class="attr">click.prevent</span>=<span class="string">"hello"</span>&gt;</span>去百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>上面的这两个嵌套div中，如果点击了内层的div，则外层的div也会被触发；这种问题可以事件修饰符来完成：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 事件修饰符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border: 1px solid red;padding: 20px;"</span> <span class="attr">v-on:click.once</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">            大div</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border: 1px solid blue;padding: 20px;"</span> @<span class="attr">click.stop</span>=<span class="string">"hello"</span>&gt;</span></span><br><span class="line">                小div </span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span> @<span class="attr">click.prevent.stop</span>=<span class="string">"hello"</span>&gt;</span>去百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--这里禁止了超链接的点击跳转操作，并且只会触发当前对象的操作--&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>关于事件修饰符：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336764-a1fa6d7a-157c-4d53-ae4c-0504cbfbdb9a.png#align=left&amp;display=inline&amp;height=402&amp;margin=%5Bobject%20Object%5D&amp;originHeight=402&amp;originWidth=1084&amp;status=done&amp;style=none&amp;width=1084" alt><br>按键修饰符：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336822-515e5adb-dc25-49f3-8e35-3b36b3e9452c.png#align=left&amp;display=inline&amp;height=665&amp;margin=%5Bobject%20Object%5D&amp;originHeight=665&amp;originWidth=1127&amp;status=done&amp;style=none&amp;width=1127" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336865-2da6ad4d-8295-430e-8866-bdcd1c71e63c.png#align=left&amp;display=inline&amp;height=204&amp;margin=%5Bobject%20Object%5D&amp;originHeight=204&amp;originWidth=1164&amp;status=done&amp;style=none&amp;width=1164" alt></p>
<h3 id="7、v-for遍历循环"><a href="#7、v-for遍历循环" class="headerlink" title="7、v-for遍历循环"></a>7、v-for遍历循环</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(user,index) in users"</span> <span class="attr">:key</span>=<span class="string">"user.name"</span> <span class="attr">v-if</span>=<span class="string">"user.gender == '女'"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 1、显示user信息：v-for="item in items" --&gt;</span></span><br><span class="line">               当前索引：&#123;&#123;index&#125;&#125; ==&gt; &#123;&#123;user.name&#125;&#125;  ==&gt;   &#123;&#123;user.gender&#125;&#125; ==&gt;&#123;&#123;user.age&#125;&#125; <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 2、获取数组下标：v-for="(item,index) in items" --&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 3、遍历对象：</span></span><br><span class="line"><span class="comment">                        v-for="value in object"</span></span><br><span class="line"><span class="comment">                        v-for="(value,key) in object"</span></span><br><span class="line"><span class="comment">                        v-for="(value,key,index) in object" </span></span><br><span class="line"><span class="comment">                --&gt;</span></span><br><span class="line">                对象信息：</span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-for</span>=<span class="string">"(v,k,i) in user"</span>&gt;</span>&#123;&#123;k&#125;&#125;==&#123;&#123;v&#125;&#125;==&#123;&#123;i&#125;&#125;；<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 4、遍历的时候都加上:key来区分不同数据，提高vue渲染效率 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(num,index) in nums"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span>         </span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">            el: <span class="string">"#app"</span>,</span></span><br><span class="line">            data: &#123;</span><br><span class="line"><span class="actionscript">                users: [&#123; name: <span class="string">'柳岩'</span>, gender: <span class="string">'女'</span>, age: <span class="number">21</span> &#125;,</span></span><br><span class="line"><span class="actionscript">                &#123; name: <span class="string">'张三'</span>, gender: <span class="string">'男'</span>, age: <span class="number">18</span> &#125;,</span></span><br><span class="line"><span class="actionscript">                &#123; name: <span class="string">'范冰冰'</span>, gender: <span class="string">'女'</span>, age: <span class="number">24</span> &#125;,</span></span><br><span class="line"><span class="actionscript">                &#123; name: <span class="string">'刘亦菲'</span>, gender: <span class="string">'女'</span>, age: <span class="number">18</span> &#125;,</span></span><br><span class="line"><span class="actionscript">                &#123; name: <span class="string">'古力娜扎'</span>, gender: <span class="string">'女'</span>, age: <span class="number">25</span> &#125;],</span></span><br><span class="line">                nums: [1,2,3,4,4]</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4、遍历的时候都加上:key来区分不同数据，提高vue渲染效率</p>
<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 过滤器常用来处理文本格式化的操作。过滤器可以用在两个地方：双花括号插值和 v-bind 表达式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"user in userList"</span>&gt;</span></span><br><span class="line">                &#123;&#123;user.id&#125;&#125; ==&gt; &#123;&#123;user.name&#125;&#125; ==&gt; &#123;&#123;user.gender == 1?"男":"女"&#125;&#125; ==&gt;</span><br><span class="line">                &#123;&#123;user.gender | genderFilter&#125;&#125; ==&gt; &#123;&#123;user.gender | gFilter&#125;&#125;</span><br><span class="line">                <span class="comment">&lt;!-- 这里的"|"表示的管道，将user.gender的值交给genderFilter --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 全局过滤器 </span></span></span><br><span class="line"><span class="actionscript">        Vue.filter(<span class="string">"gFilter"</span>, <span class="function"><span class="keyword">function</span> <span class="params">(val)</span> </span>&#123;</span></span><br><span class="line">            if (val == 1) &#123;</span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> <span class="string">"男~~~"</span>;</span></span><br><span class="line"><span class="actionscript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> <span class="string">"女~~~"</span>;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">            el: <span class="string">"#app"</span>,</span></span><br><span class="line">            data: &#123;</span><br><span class="line">                userList: [</span><br><span class="line"><span class="actionscript">                    &#123; id: <span class="number">1</span>, name: <span class="string">'jacky'</span>, gender: <span class="number">1</span> &#125;,</span></span><br><span class="line"><span class="actionscript">                    &#123; id: <span class="number">2</span>, name: <span class="string">'peter'</span>, gender: <span class="number">0</span> &#125;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            filters: &#123;</span><br><span class="line"><span class="actionscript">                <span class="comment">//// filters 定义局部过滤器，只可以在当前vue实例中使用</span></span></span><br><span class="line">                genderFilter(val) &#123;</span><br><span class="line">                    if (val == 1) &#123;</span><br><span class="line"><span class="actionscript">                        <span class="keyword">return</span> <span class="string">"男"</span>;</span></span><br><span class="line"><span class="actionscript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">return</span> <span class="string">"女"</span>;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="组件化"><a href="#组件化" class="headerlink" title="组件化"></a>组件化</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">"count++"</span>&gt;</span>我被点击了 &#123;&#123;count&#125;&#125; 次<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">counter</span>&gt;</span><span class="tag">&lt;/<span class="name">counter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">counter</span>&gt;</span><span class="tag">&lt;/<span class="name">counter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">counter</span>&gt;</span><span class="tag">&lt;/<span class="name">counter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">counter</span>&gt;</span><span class="tag">&lt;/<span class="name">counter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">counter</span>&gt;</span><span class="tag">&lt;/<span class="name">counter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用所定义的组件button-counter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button-counter</span>&gt;</span><span class="tag">&lt;/<span class="name">button-counter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//1、全局声明注册一个组件</span></span></span><br><span class="line"><span class="actionscript">        Vue.component(<span class="string">"counter"</span>, &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">            template: `<span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">"count++"</span>&gt;</span>我被点击了 </span><span class="template-variable">&#123;&#123;count&#125;&#125;</span><span class="xml"> 次<span class="tag">&lt;/<span class="name">button</span>&gt;</span>`,</span></span></span><br><span class="line">            data() &#123;</span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> &#123;</span></span><br><span class="line">                    count: 1</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="actionscript">        <span class="comment">//2、局部声明一个组件</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> buttonCounter = &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">            template: `<span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">"count++"</span>&gt;</span>我被点击了 </span><span class="template-variable">&#123;&#123;count&#125;&#125;</span><span class="xml"> 次~~~<span class="tag">&lt;/<span class="name">button</span>&gt;</span>`,</span></span></span><br><span class="line">            data() &#123;</span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> &#123;</span></span><br><span class="line">                    count: 1</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="actionscript">        <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">            el: <span class="string">"#app"</span>,</span></span><br><span class="line">            data: &#123;</span><br><span class="line">                count: 1</span><br><span class="line">            &#125;,</span><br><span class="line">            components: &#123;</span><br><span class="line"><span class="actionscript">                <span class="comment">//声明所定义的局部组件</span></span></span><br><span class="line"><span class="actionscript">                <span class="string">'button-counter'</span>: buttonCounter</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341336925-12a20bb8-3166-4c02-9a0e-b27af23c4cb2.png#align=left&amp;display=inline&amp;height=225&amp;margin=%5Bobject%20Object%5D&amp;originHeight=225&amp;originWidth=911&amp;status=done&amp;style=none&amp;width=911" alt></p>
<h3 id="生命周期钩子函数"><a href="#生命周期钩子函数" class="headerlink" title="生命周期钩子函数"></a>生命周期钩子函数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"num"</span>&gt;</span>&#123;&#123;num&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"num++"</span>&gt;</span>赞！<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;name&#125;&#125;，有&#123;&#123;num&#125;&#125;个人点赞<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../node_modules/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">            el: <span class="string">"#app"</span>,</span></span><br><span class="line">            data: &#123;</span><br><span class="line"><span class="actionscript">                name: <span class="string">"张三"</span>,</span></span><br><span class="line">                num: 100</span><br><span class="line">            &#125;,</span><br><span class="line">            methods: &#123;</span><br><span class="line">                show() &#123;</span><br><span class="line"><span class="actionscript">                    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                add() &#123;</span><br><span class="line"><span class="actionscript">                    <span class="keyword">this</span>.num++;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            beforeCreate() &#123;</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"=========beforeCreate============="</span>);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"数据模型未加载："</span> + <span class="keyword">this</span>.name, <span class="keyword">this</span>.num);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"方法未加载："</span> + <span class="keyword">this</span>.show());</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"html模板未加载："</span> + <span class="built_in">document</span>.getElementById(<span class="string">"num"</span>));</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="actionscript">            created: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"=========created============="</span>);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"数据模型已加载："</span> + <span class="keyword">this</span>.name, <span class="keyword">this</span>.num);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"方法已加载："</span> + <span class="keyword">this</span>.show());</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"html模板已加载："</span> + <span class="built_in">document</span>.getElementById(<span class="string">"num"</span>));</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"html模板未渲染："</span> + <span class="built_in">document</span>.getElementById(<span class="string">"num"</span>).innerText);</span></span><br><span class="line">            &#125;,</span><br><span class="line">            beforeMount() &#123;</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"=========beforeMount============="</span>);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"html模板未渲染："</span> + <span class="built_in">document</span>.getElementById(<span class="string">"num"</span>).innerText);</span></span><br><span class="line">            &#125;,</span><br><span class="line">            mounted() &#123;</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"=========mounted============="</span>);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"html模板已渲染："</span> + <span class="built_in">document</span>.getElementById(<span class="string">"num"</span>).innerText);</span></span><br><span class="line">            &#125;,</span><br><span class="line">            beforeUpdate() &#123;</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"=========beforeUpdate============="</span>);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"数据模型已更新："</span> + <span class="keyword">this</span>.num);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"html模板未更新："</span> + <span class="built_in">document</span>.getElementById(<span class="string">"num"</span>).innerText);</span></span><br><span class="line">            &#125;,</span><br><span class="line">            updated() &#123;</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"=========updated============="</span>);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"数据模型已更新："</span> + <span class="keyword">this</span>.num);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"html模板已更新："</span> + <span class="built_in">document</span>.getElementById(<span class="string">"num"</span>).innerText);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="13-element-ui"><a href="#13-element-ui" class="headerlink" title="13. element ui"></a>13. element ui</h2><p>官网： <a href="https://element.eleme.cn/#/zh-CN/component/installation" target="_blank" rel="noopener">https://element.eleme.cn/#/zh-CN/component/installation</a><br>安装<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i element-ui -S</span><br></pre></td></tr></table></figure></p>
<p>在 main.js 中写入以下内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ElementUI  <span class="keyword">from</span> <span class="string">'element-ui'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'element-ui/lib/theme-chalk/index.css'</span>;</span><br><span class="line">Vue.use(ElementUI);</span><br></pre></td></tr></table></figure></p>
<h2 id="14-递归树形结构获取数据"><a href="#14-递归树形结构获取数据" class="headerlink" title="14. 递归树形结构获取数据"></a>14. 递归树形结构获取数据</h2><p>在注册中心中“product”命名空间中，创建“gulimall-product.yml”配置文件：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337004-ac673979-3e57-4e30-9846-0eacd8f3cd1d.png#align=left&amp;display=inline&amp;height=394&amp;margin=%5Bobject%20Object%5D&amp;originHeight=394&amp;originWidth=1379&amp;status=done&amp;style=none&amp;width=1379" alt><br>将“application.yml”内容拷贝到该配置文件中<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#MySQL配置</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.137.14:3306/gulimall_pms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-product</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span><span class="string">:8848</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br></pre></td></tr></table></figure></p>
<p>在本地创建“bootstrap.properties”文件，指明配置中心的位置和使用到的配置文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=gulimall-product</span><br><span class="line">spring.cloud.nacos.config.server-addr=192.168.137.14:8848</span><br><span class="line">spring.cloud.nacos.config.namespace=3c50ffaa-010b-4b59-9372-902e35059232</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].data-id=gulimall-product.yml</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].group=DEFAULT_GROUP</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].refresh=true</span><br></pre></td></tr></table></figure></p>
<p>然后启动gulimall-product，查看到该服务已经出现在了nacos的注册中心中了<br>修改“com.bigdata.gulimall.product.service.CategoryService”类，添加如下代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/list/tree"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title">list</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;CategoryEntity&gt; categoryEntities = categoryService.listWithTree();</span><br><span class="line">        <span class="keyword">return</span> categoryEntities;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>测试：<a href="http://localhost:10000/product/category/list/tree" target="_blank" rel="noopener">http://localhost:10000/product/category/list/tree</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337061-8fee9297-c2a9-4429-9d94-bca1f732288d.png#align=left&amp;display=inline&amp;height=210&amp;margin=%5Bobject%20Object%5D&amp;originHeight=210&amp;originWidth=935&amp;status=done&amp;style=none&amp;width=935" alt><br>如何区别是哪种分类级别？<br>答：可以通过分类的parent_cid来进行判断，如果是一级分类，其值为0.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/list/tree"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title">list</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;CategoryEntity&gt; categoryEntities = categoryService.listWithTree();</span><br><span class="line">        <span class="comment">//找到所有的一级分类</span></span><br><span class="line">        List&lt;CategoryEntity&gt; level1Menus = categoryEntities.stream()</span><br><span class="line">                .filter(item -&gt; item.getParentCid() == <span class="number">0</span>)</span><br><span class="line">                .map(menu-&gt;&#123;</span><br><span class="line">                    menu.setChildCategoryEntity(getChildrens(menu,categoryEntities));</span><br><span class="line">                    <span class="keyword">return</span> menu;</span><br><span class="line">                &#125;)</span><br><span class="line">                .sorted((menu1, menu2) -&gt; &#123;</span><br><span class="line">                  <span class="keyword">return</span> (menu1.getSort() ==<span class="keyword">null</span> ? <span class="number">0</span>:menu1.getSort())- (menu2.getSort()==<span class="keyword">null</span>?<span class="number">0</span>:menu2.getSort());</span><br><span class="line">                &#125;)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> level1Menus;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title">getChildrens</span><span class="params">(CategoryEntity root,List&lt;CategoryEntity&gt; all)</span></span>&#123;</span><br><span class="line">        List&lt;CategoryEntity&gt; childrens = all.stream().filter(item -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> item.getParentCid() == root.getCatId();</span><br><span class="line">        &#125;).map(item -&gt; &#123;</span><br><span class="line">            item.setChildCategoryEntity(getChildrens(item, all));</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;).sorted((menu1, menu2) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> (menu1.getSort() ==<span class="keyword">null</span> ? <span class="number">0</span>:menu1.getSort())- (menu2.getSort()==<span class="keyword">null</span>?<span class="number">0</span>:menu2.getSort());</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> childrens;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>下面是得到的部分JSON数据<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"catId"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"图书、音像、电子书刊"</span>,</span><br><span class="line">    <span class="attr">"parentCid"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"catLevel"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"showStatus"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"sort"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"icon"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"productUnit"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"productCount"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"childCategoryEntity"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"catId"</span>: <span class="number">22</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"电子书刊"</span>,</span><br><span class="line">        <span class="attr">"parentCid"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"catLevel"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"showStatus"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"sort"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"productUnit"</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"productCount"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"childCategoryEntity"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"catId"</span>: <span class="number">165</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"电子书"</span>,</span><br><span class="line">            <span class="attr">"parentCid"</span>: <span class="number">22</span>,</span><br><span class="line">            <span class="attr">"catLevel"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"showStatus"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"sort"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"icon"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productUnit"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productCount"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"childCategoryEntity"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"catId"</span>: <span class="number">166</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"网络原创"</span>,</span><br><span class="line">            <span class="attr">"parentCid"</span>: <span class="number">22</span>,</span><br><span class="line">            <span class="attr">"catLevel"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"showStatus"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"sort"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"icon"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productUnit"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productCount"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"childCategoryEntity"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"catId"</span>: <span class="number">167</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"数字杂志"</span>,</span><br><span class="line">            <span class="attr">"parentCid"</span>: <span class="number">22</span>,</span><br><span class="line">            <span class="attr">"catLevel"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"showStatus"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"sort"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"icon"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productUnit"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productCount"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"childCategoryEntity"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"catId"</span>: <span class="number">168</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"多媒体图书"</span>,</span><br><span class="line">            <span class="attr">"parentCid"</span>: <span class="number">22</span>,</span><br><span class="line">            <span class="attr">"catLevel"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"showStatus"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"sort"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"icon"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productUnit"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productCount"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"childCategoryEntity"</span>: []</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"catId"</span>: <span class="number">23</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"音像"</span>,</span><br><span class="line">        <span class="attr">"parentCid"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"catLevel"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"showStatus"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"sort"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"icon"</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"productUnit"</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"productCount"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"childCategoryEntity"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"catId"</span>: <span class="number">169</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"音乐"</span>,</span><br><span class="line">            <span class="attr">"parentCid"</span>: <span class="number">23</span>,</span><br><span class="line">            <span class="attr">"catLevel"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"showStatus"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"sort"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"icon"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productUnit"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productCount"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"childCategoryEntity"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"catId"</span>: <span class="number">170</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"影视"</span>,</span><br><span class="line">            <span class="attr">"parentCid"</span>: <span class="number">23</span>,</span><br><span class="line">            <span class="attr">"catLevel"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"showStatus"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"sort"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"icon"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productUnit"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productCount"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"childCategoryEntity"</span>: []</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"catId"</span>: <span class="number">171</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"教育音像"</span>,</span><br><span class="line">            <span class="attr">"parentCid"</span>: <span class="number">23</span>,</span><br><span class="line">            <span class="attr">"catLevel"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"showStatus"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"sort"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"icon"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productUnit"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"productCount"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"childCategoryEntity"</span>: []</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br></pre></td></tr></table></figure></p>
<p>启动后端项目renren-fast<br>启动前端项目renren-fast-vue：<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">run</span><span class="bash"> dev</span></span><br></pre></td></tr></table></figure></p>
<p>访问： <a href="http://localhost:8001/#/login" target="_blank" rel="noopener">http://localhost:8001/#/login</a><br>创建一级菜单：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337113-46d9618d-32f7-44b2-b177-9ea8d30618dd.png#align=left&amp;display=inline&amp;height=595&amp;margin=%5Bobject%20Object%5D&amp;originHeight=595&amp;originWidth=1444&amp;status=done&amp;style=none&amp;width=1444" alt><br>创建完成后，在后台的管理系统中会创建一条记录：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337151-3d1b7830-33b3-4c1d-9fc1-870c3b54c6ea.png#align=left&amp;display=inline&amp;height=784&amp;margin=%5Bobject%20Object%5D&amp;originHeight=784&amp;originWidth=1475&amp;status=done&amp;style=none&amp;width=1475" alt><br>然后创建子菜单：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337208-0bd100ad-d0c0-495b-89d7-48ffcc8d63db.png#align=left&amp;display=inline&amp;height=712&amp;margin=%5Bobject%20Object%5D&amp;originHeight=712&amp;originWidth=1451&amp;status=done&amp;style=none&amp;width=1451" alt><br>创建renren-fast-vue\src\views\modules\product目录，子所以是这样来创建，是因为product/category，对应于product-category<br>在该目录下，新建“category.vue”文件：<br>刷新页面出现404异常，查看请求发现，请求的是“<a href="http://localhost:8080/renren-fast/product/category/list/tree”" target="_blank" rel="noopener">http://localhost:8080/renren-fast/product/category/list/tree”</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337249-0001459a-6be5-46c0-a653-977fe9ad0469.png#align=left&amp;display=inline&amp;height=522&amp;margin=%5Bobject%20Object%5D&amp;originHeight=522&amp;originWidth=1919&amp;status=done&amp;style=none&amp;width=1919" alt><br>这个请求是不正确的，正确的请求是：<a href="http://localhost:10000/product/category/list/tree，" target="_blank" rel="noopener">http://localhost:10000/product/category/list/tree，</a><br>修正这个问题：<br>替换“static\config\index.js”文件中的“window.SITE_CONFIG[‘baseUrl’]”<br>替换前：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.SITE_CONFIG[<span class="string">'baseUrl'</span>] = <span class="string">'http://localhost:8080/renren-fast'</span>;</span><br></pre></td></tr></table></figure></p>
<p>替换后：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.SITE_CONFIG[<span class="string">'baseUrl'</span>] = <span class="string">'http://localhost:88/api'</span>;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://localhost:88，这个地址是我们网关微服务的接口。" target="_blank" rel="noopener">http://localhost:88，这个地址是我们网关微服务的接口。</a><br>这里我们需要通过网关来完成路径的映射，因此将renren-fast注册到nacos注册中心中，并添加配置中心<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">renren-fast</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">renren-fast</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.8848</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">ee409c3f-3206-4a3b-ba65-7376922a886d</span></span><br></pre></td></tr></table></figure></p>
<p>配置网关路由，前台的所有请求都是经由“<a href="http://localhost:88/api”来转发的，在“gulimall-gateway”中添加路由规则：" target="_blank" rel="noopener">http://localhost:88/api”来转发的，在“gulimall-gateway”中添加路由规则：</a><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br></pre></td></tr></table></figure></p>
<p>但是这样做也引入了另外的一个问题，再次访问：<a href="http://localhost:8001/#/login，发现验证码不再显示：" target="_blank" rel="noopener">http://localhost:8001/#/login，发现验证码不再显示：</a><br>分析原因：</p>
<ol>
<li>现在的验证码请求路径为，<a href="http://localhost:88/api/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6" target="_blank" rel="noopener">http://localhost:88/api/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</a></li>
<li>原始的验证码请求路径：<a href="http://localhost:8001/renren-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6" target="_blank" rel="noopener">http://localhost:8001/renren-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</a></li>
</ol>
<p>在admin_route的路由规则下，在访问路径中包含了“api”，因此它会将它转发到renren-fast，网关在转发的时候，会使用网关的前缀信息，为了能够正常的取得验证码，我们需要对请求路径进行重写<br>关于请求路径重写：<br><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.2.RELEASE/reference/html/#the-rewritepath-gatewayfilter-factory" target="_blank" rel="noopener">6.16. The <code>RewritePath</code> <code>GatewayFilter</code> Factory</a><br>The <code>RewritePath</code> <code>GatewayFilter</code> factory takes a path <code>regexp</code> parameter and a <code>replacement</code> parameter. This uses Java regular expressions for a flexible way to rewrite the request path. The following listing configures a <code>RewritePath</code> <code>GatewayFilter</code>:<br>Example 41. application.yml<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">rewritepath_route</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">https://example.org</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/foo/**</span></span><br><span class="line">        <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">RewritePath=/red(?&lt;segment&gt;/?.*),</span> <span class="string">$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>For a request path of <code>/red/blue</code>, this sets the path to <code>/blue</code> before making the downstream request. Note that the <code>$</code> should be replaced with <code>$\</code> because of the YAML specification.<br>修改“admin_route”路由规则：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),</span> <span class="string">/renren-fast/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>再次访问：<a href="http://localhost:8001/#/login，验证码能够正常的加载了。" target="_blank" rel="noopener">http://localhost:8001/#/login，验证码能够正常的加载了。</a><br>但是很不幸新的问题又产生了，访问被拒绝了<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337292-02053402-6e3c-42d9-9311-a3954836d438.png#align=left&amp;display=inline&amp;height=366&amp;margin=%5Bobject%20Object%5D&amp;originHeight=366&amp;originWidth=1915&amp;status=done&amp;style=none&amp;width=1915" alt><br>问题描述：已拦截跨源请求：同源策略禁止读取位于 <a href="http://localhost:88/api/sys/login" target="_blank" rel="noopener">http://localhost:88/api/sys/login</a> 的远程资源。（原因：CORS 头缺少 ‘Access-Control-Allow-Origin’）。<br>问题分析：这是一种跨域问题。访问的域名和端口和原来的请求不同，请求就会被限制<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337331-c72d80f2-9dfb-40ec-bd9a-baa1b9199f9b.png#align=left&amp;display=inline&amp;height=651&amp;margin=%5Bobject%20Object%5D&amp;originHeight=651&amp;originWidth=1090&amp;status=done&amp;style=none&amp;width=1090" alt><br>跨域流程：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337388-2c20e71f-6e58-4c21-9e6e-e830030a003b.png#align=left&amp;display=inline&amp;height=575&amp;margin=%5Bobject%20Object%5D&amp;originHeight=575&amp;originWidth=1066&amp;status=done&amp;style=none&amp;width=1066" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337431-2f0e940d-e56e-42ab-b6c9-01b2937c324d.png#align=left&amp;display=inline&amp;height=560&amp;margin=%5Bobject%20Object%5D&amp;originHeight=560&amp;originWidth=1164&amp;status=done&amp;style=none&amp;width=1164" alt><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337482-56e33a08-8bf2-4293-87da-15933ac83f9c.png#align=left&amp;display=inline&amp;height=572&amp;margin=%5Bobject%20Object%5D&amp;originHeight=572&amp;originWidth=1146&amp;status=done&amp;style=none&amp;width=1146" alt><br>解决方法：在网关中定义“GulimallCorsConfiguration”类，该类用来做过滤，允许所有的请求跨域。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallCorsConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsWebFilter <span class="title">corsWebFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        UrlBasedCorsConfigurationSource source=<span class="keyword">new</span> UrlBasedCorsConfigurationSource();</span><br><span class="line">        CorsConfiguration corsConfiguration = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        corsConfiguration.addAllowedHeader(<span class="string">"*"</span>);</span><br><span class="line">        corsConfiguration.addAllowedMethod(<span class="string">"*"</span>);</span><br><span class="line">        corsConfiguration.addAllowedOrigin(<span class="string">"*"</span>);</span><br><span class="line">        corsConfiguration.setAllowCredentials(<span class="keyword">true</span>);</span><br><span class="line">        </span><br><span class="line">        source.registerCorsConfiguration(<span class="string">"/**"</span>,corsConfiguration);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsWebFilter(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>再次访问：<a href="http://localhost:8001/#/login" target="_blank" rel="noopener">http://localhost:8001/#/login</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337538-baacada4-f1df-426c-a58b-05ca0e05bc87.png#align=left&amp;display=inline&amp;height=439&amp;margin=%5Bobject%20Object%5D&amp;originHeight=439&amp;originWidth=1688&amp;status=done&amp;style=none&amp;width=1688" alt><br><a href="http://localhost:8001/renre已拦截跨源请求：同源策略禁止读取位于" target="_blank" rel="noopener">http://localhost:8001/renre已拦截跨源请求：同源策略禁止读取位于</a> <a href="http://localhost:88/api/sys/login" target="_blank" rel="noopener">http://localhost:88/api/sys/login</a> 的远程资源。（原因：不允许有多个 ‘Access-Control-Allow-Origin’ CORS 头）n-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6<br>出现了多个请求，并且也存在多个跨源请求。<br>为了解决这个问题，需要修改renren-fast项目，注释掉“io.renren.config.CorsConfig”类。然后再次进行访问。<br>在显示分类信息的时候，出现了404异常，请求的<a href="http://localhost:88/api/product/category/list/tree不存在" target="_blank" rel="noopener">http://localhost:88/api/product/category/list/tree不存在</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337581-fcee076f-2538-4bbb-8ef7-35fd9f824f3c.png#align=left&amp;display=inline&amp;height=391&amp;margin=%5Bobject%20Object%5D&amp;originHeight=391&amp;originWidth=1783&amp;status=done&amp;style=none&amp;width=1783" alt><br>这是因为网关上所做的路径映射不正确，映射后的路径为<a href="http://localhost:8001/renren-fast/product/category/list/tree" target="_blank" rel="noopener">http://localhost:8001/renren-fast/product/category/list/tree</a><br>但是只有通过<a href="http://localhost:10000/product/category/list/tree路径才能够正常访问，所以会报404异常。" target="_blank" rel="noopener">http://localhost:10000/product/category/list/tree路径才能够正常访问，所以会报404异常。</a><br>解决方法就是定义一个product路由规则，进行路径重写：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">product_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-product</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/product/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>在路由规则的顺序上，将精确的路由规则放置到模糊的路由规则的前面，否则的话，精确的路由规则将不会被匹配到，类似于异常体系中try catch子句中异常的处理顺序。</p>
<h2 id="15-删除数据"><a href="#15-删除数据" class="headerlink" title="15. 删除数据"></a>15. 删除数据</h2><p>添加delete和append标识，并且增加复选框<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tree</span><br><span class="line">    :data=&quot;menus&quot;</span><br><span class="line">    show-checkbox  //显示复选框</span><br><span class="line">    :props=&quot;defaultProps&quot;  </span><br><span class="line">    :expand-on-click-node=&quot;false&quot; //设置节点点击时不展开</span><br><span class="line">    node-key=&quot;catId&quot;   </span><br><span class="line">  &gt;</span><br><span class="line">    &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">      &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;span&gt;</span><br><span class="line">        &lt;el-button v-if=&quot;node.level &lt;= 2&quot; type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;() =&gt; append(data)&quot;&gt;Append&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          size=&quot;mini&quot;</span><br><span class="line">          @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">        &gt;Delete&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">  &lt;/el-tree&gt;</span><br></pre></td></tr></table></figure></p>
<p>测试删除数据，打开postman输入“ <a href="http://localhost:88/api/product/category/delete" target="_blank" rel="noopener">http://localhost:88/api/product/category/delete</a> ”，请求方式设置为POST，为了比对效果，可以在删除之前查询数据库的pms_category表：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337634-a9bf7a12-6a24-4c65-b3eb-266a882b1d85.png#align=left&amp;display=inline&amp;height=56&amp;margin=%5Bobject%20Object%5D&amp;originHeight=56&amp;originWidth=1063&amp;status=done&amp;style=none&amp;width=1063" alt><br>由于delete请求接收的是一个数组，所以这里使用JSON方式，传入了一个数组：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337679-1d4aa88b-b98d-4520-924e-971a4ae99d66.png#align=left&amp;display=inline&amp;height=381&amp;margin=%5Bobject%20Object%5D&amp;originHeight=381&amp;originWidth=1439&amp;status=done&amp;style=none&amp;width=1439" alt><br>再次查询数据库能够看到cat_id为1000的数据已经被删除了。<br>修改“com.bigdata.gulimall.product.controller.CategoryController”类，添加如下代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">delete</span><span class="params">(@RequestBody Long[] catIds)</span></span>&#123;</span><br><span class="line">        <span class="comment">//删除之前需要判断待删除的菜单那是否被别的地方所引用。</span></span><br><span class="line"><span class="comment">//		categoryService.removeByIds(Arrays.asList(catIds));</span></span><br><span class="line">        categoryService.removeMenuByIds(Arrays.asList(catIds));</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>com.bigdata.gulimall.product.service.impl.CategoryServiceImpl<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span>   <span class="keyword">void</span> <span class="title">removeMenuByIds</span><span class="params">(List&lt;Long&gt; asList)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//TODO 检查当前的菜单是否被别的地方所引用</span></span><br><span class="line">        categoryDao.deleteBatchIds(asList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>然而多数时候，我们并不希望删除数据，而是标记它被删除了，这就是逻辑删除；<br>可以设置show_status为0，标记它已经被删除。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337719-b02436ff-338d-4408-833b-8d4cdd73e902.png#align=left&amp;display=inline&amp;height=364&amp;margin=%5Bobject%20Object%5D&amp;originHeight=364&amp;originWidth=1282&amp;status=done&amp;style=none&amp;width=1282" alt><br>mybatis-plus的逻辑删除：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337773-01f6a771-17e4-4f4c-8a35-e448bee95904.png#align=left&amp;display=inline&amp;height=705&amp;margin=%5Bobject%20Object%5D&amp;originHeight=705&amp;originWidth=1465&amp;status=done&amp;style=none&amp;width=1465" alt><br>配置全局的逻辑删除规则，在“src/main/resources/application.yml”文件中添加如下内容：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>修改“com.bigdata.gulimall.product.entity.CategoryEntity”类，添加上@TableLogic，表明使用逻辑删除：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 是否显示[0-不显示，1显示]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@TableLogic</span>(value = <span class="string">"1"</span>,delval = <span class="string">"0"</span>)</span><br><span class="line">	<span class="keyword">private</span> Integer showStatus;</span><br></pre></td></tr></table></figure></p>
<p>然后在POSTMan中测试一下是否能够满足需要。另外在“src/main/resources/application.yml”文件中，设置日志级别，打印出SQL语句：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.bigdata.gulimall.product:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure></p>
<p>打印的日志：<br><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">==&gt;  Preparing: UPDATE pms_category SET show_status=<span class="number">0</span> WHERE cat_id IN ( ? ) AND show_status=<span class="number">1</span> </span><br><span class="line"> ==&gt; Parameters: <span class="number">1431</span>(Long)</span><br><span class="line"> &lt;==    Updates: <span class="number">1</span></span><br><span class="line"> get changedGroupKeys:[]</span><br></pre></td></tr></table></figure></p>
<h2 id="16-菜单拖动"><a href="#16-菜单拖动" class="headerlink" title="16. 菜单拖动"></a>16. 菜单拖动</h2><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>同一个菜单内拖动</td>
<td>正常</td>
</tr>
<tr>
<td>拖动到父菜单的前面或后面</td>
<td>正常</td>
</tr>
<tr>
<td>拖动到父菜单同级的另外一个菜单中</td>
<td>正常</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>关注的焦点在于，拖动到目标节点中，使得目标节点的catlevel+deep小于3即可。拖动到目标节点前后的条件是，使得</p>
<h3 id="拖动菜单时需要修改顺序和级别"><a href="#拖动菜单时需要修改顺序和级别" class="headerlink" title="拖动菜单时需要修改顺序和级别"></a>拖动菜单时需要修改顺序和级别</h3><p>需要考虑两种类型节点的catLevel<br>一种关系是：如果是同一个节点下的子节点的前后移动，则不需要修改其catLevel<br>如果是拖动到另外一个节点内或父节点中，则要考虑修改其catLevel<br>如果拖动到与父节点平级的节点关系中，则要将该拖动的节点的catLevel，设置为兄弟节点的Level，<br>先考虑parentCid还是先考虑catLevel?<br>两种关系在耦合<br>另外还有一种是前后拖动的情况<br>哪个范围最大？<br>肯定是拖动类型关系最大，<br>如果是前后拖动，则拖动后需要看待拖动节点的层级和设置待拖动节点的parentId，<br>如果待拖动节点和目标节点的层级相同，则认为是同级拖动，只需要修改节点的先后顺序即可；<br>否则认为是跨级拖动，则需要修改层级和重新设置parentID<br>如果<br>以拖动类型来分，并不合适，比较合适的是跨级拖动和同级拖动<br>如何判断是跨级拖动还是同级拖动，根据拖动的层级来看，如果是同一级的拖动，只需要修改先后顺序即可，但是这样也会存在一个问题，就是当拖动到另外一个分组下的同级目录中，显然也需要修改parentID，究竟什么样的模型最好呢？<br>另外也可以判断在跨级移动时，跨级后的parentID是否相同，如果不相同，则认为是在不同目录下的跨级移动需要修改parentID。<br>顺序、catLevel和parentID<br>同级移动：<br>（1）首先判断待移动节点和目标节点的catLevel是否相同，<br>（2）相同则认为是同级移动，<br>如果此时移动后目标节点的parentID和待移动节点的相同，但是移动类型是前后移动，只需要调整顺序即可，此时移动类型是inner，则需要修改catLevel和parentId和顺序<br>如果此时移动后目标节点的parentID和待移动节点的不相同，但是移动类型是前后移动，则需要调整顺序和parentId，此时移动类型是inner，则需要修改catLevel和parentId和顺序<br>通过这两步的操作能看到一些共性，如果抽取移动类型作为大的分类，则在这种分类下，<br>如果是前后移动，则分为下面几种情况：<br>同级别下的前后移动：界定标准为catLevel相同，但是又可以分为parentID相同和parentID不同，parent相同时，只需要修改顺序即可；parentID不同时，需要修改parentID和顺序<br>不同级别下的前后移动：界定标准为catLevel不同，此时无论如何都要修改parentID，顺序和catLevel<br>如果是inner类型移动，则分为一下的几种情况。<br>此时不论是同级inner，还是跨级innner，都需要修改parentID，顺序和catLevel<br>哪种情况需要更新子节点呢？<br>那就要看要拖拽的节点是否含有子节点，如果有子节点，则需要更新子节点的catLevel，不需要更新它之间的顺序和parentId，只需要更新catLevel即可。这种更新子节点的Level应该归类，目前的目标是只要有子节点就更新它的catLevel，<br>（2）如果待移动节点和目标节点的catLevel不同，则认为是跨级移动。如果是移动到父节点中，则需要设置catLevel，parentID和顺序。此时需要分两种情况来考虑，如果是移动到父节点中，则需要设置catLevel，parentID和顺序，如果是移动到兄弟节点中，则需要设置<br>包含移动到父节点同级目录，兄弟节点中。</p>
<h3 id="设置菜单拖动开关"><a href="#设置菜单拖动开关" class="headerlink" title="设置菜单拖动开关"></a>设置菜单拖动开关</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-switch v-model=&quot;draggable&quot; active-text=&quot;开启拖拽&quot; inactive-text=&quot;关闭拖拽&quot;&gt;&lt;/el-switch&gt;</span><br></pre></td></tr></table></figure>
<p>但是现在存在的一个问题是每次拖拽的时候，都会发送请求，更新数据库这样频繁的与数据库交互，现在想要实现一个拖拽过程中不更新数据库，拖拽完成后，统一提交拖拽后的数据。<br>现在还存在一个问题，如果是将一个菜单连续的拖拽，最终还放到了原来的位置，但是updateNode中却出现了很多节点更新信息，这样显然也是一个问题。</p>
<h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=&quot;danger&quot; plain size=&quot;small&quot; @click=&quot;batchDelete&quot;&gt;批量删除&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//批量删除</span></span><br><span class="line">    batchDelete() &#123;</span><br><span class="line">      <span class="keyword">let</span> checkNodes = <span class="keyword">this</span>.$refs.menuTree.getCheckedNodes();</span><br><span class="line">      <span class="comment">//  console.log("被选中的节点：",checkNodes);</span></span><br><span class="line">      <span class="keyword">let</span> catIds = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; checkNodes.length; i++) &#123;</span><br><span class="line">        catIds.push(checkNodes[i].catId);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.$confirm(<span class="string">`确定要删除?`</span>, <span class="string">"提示"</span>, &#123;</span><br><span class="line">        confirmButtonText: <span class="string">"确定"</span>,</span><br><span class="line">        cancelButtonText: <span class="string">"取消"</span>,</span><br><span class="line">        type: <span class="string">"warning"</span></span><br><span class="line">      &#125;)</span><br><span class="line">        .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.$http(&#123;</span><br><span class="line">            url: <span class="keyword">this</span>.$http.adornUrl(<span class="string">"/product/category/delete"</span>),</span><br><span class="line">            method: <span class="string">"post"</span>,</span><br><span class="line">            data: <span class="keyword">this</span>.$http.adornData(catIds, <span class="literal">false</span>)</span><br><span class="line">          &#125;).then(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.$message(&#123;</span><br><span class="line">              message: <span class="string">"菜单批量删除成功"</span>,</span><br><span class="line">              type: <span class="string">"success"</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">//重新刷新页面</span></span><br><span class="line">            <span class="keyword">this</span>.getMeus();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//取消删除</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h2 id="17-品牌管理菜单"><a href="#17-品牌管理菜单" class="headerlink" title="17. 品牌管理菜单"></a>17. 品牌管理菜单</h2><p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337850-ac8f9030-5d8a-4bab-ae9e-7dbec2541a91.png#align=left&amp;display=inline&amp;height=808&amp;margin=%5Bobject%20Object%5D&amp;originHeight=808&amp;originWidth=980&amp;status=done&amp;style=none&amp;width=980" alt><br>（2）将“”逆向工程得到的resources\src\views\modules\product文件拷贝到gulimall/renren-fast-vue/src/views/modules/product目录下，也就是下面的两个文件<br>brand.vue  brand-add-or-update.vue<br>但是显示的页面没有新增和删除功能，这是因为权限控制的原因，<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337895-3d47391a-2f70-4872-9ac3-d43b138a113e.png#align=left&amp;display=inline&amp;height=390&amp;margin=%5Bobject%20Object%5D&amp;originHeight=390&amp;originWidth=1539&amp;status=done&amp;style=none&amp;width=1539" alt><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button v-if=&quot;isAuth(&apos;product:brand:save&apos;)&quot; type=&quot;primary&quot; @click=&quot;addOrUpdateHandle()&quot;&gt;新增&lt;/el-button&gt;</span><br><span class="line">&lt;el-button v-if=&quot;isAuth(&apos;product:brand:delete&apos;)&quot; type=&quot;danger&quot; @click=&quot;deleteHandle()&quot; :disabled=&quot;dataListSelections.length &lt;= 0&quot;&gt;批量删除&lt;/el-button&gt;</span><br></pre></td></tr></table></figure></p>
<p>查看“isAuth”的定义位置：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337928-1c624739-1d66-4fed-a26b-31cb09a8796f.png#align=left&amp;display=inline&amp;height=234&amp;margin=%5Bobject%20Object%5D&amp;originHeight=234&amp;originWidth=1416&amp;status=done&amp;style=none&amp;width=1416" alt><br>它是在“index.js”中定义，现在将它设置为返回值为true，即可显示添加和删除功能。<br>再次刷新页面能够看到，按钮已经出现了：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341337968-d538c8d6-22e7-4725-baa6-40a769cf8cef.png#align=left&amp;display=inline&amp;height=409&amp;margin=%5Bobject%20Object%5D&amp;originHeight=409&amp;originWidth=1555&amp;status=done&amp;style=none&amp;width=1555" alt></p>
<h3 id="添加“显示状态按钮”"><a href="#添加“显示状态按钮”" class="headerlink" title="添加“显示状态按钮”"></a>添加“显示状态按钮”</h3><p>brand.vue<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">  &lt;el-switch</span><br><span class="line">    v-model=&quot;scope.row.showStatus&quot;</span><br><span class="line">    active-color=&quot;#13ce66&quot;</span><br><span class="line">    inactive-color=&quot;#ff4949&quot;</span><br><span class="line">    @change=&quot;updateBrandStatus(scope.row)&quot;</span><br><span class="line">    :active-value = &quot;1&quot;</span><br><span class="line">    :inactive-value	= &quot;0&quot;</span><br><span class="line">  &gt;&lt;/el-switch&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></p>
<p>brand-add-or-update.vue<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;显示状态&quot; prop=&quot;showStatus&quot;&gt;</span><br><span class="line">    &lt;el-switch v-model=&quot;dataForm.showStatus&quot; active-color=&quot;#13ce66&quot; inactive-color=&quot;#ff4949&quot;&gt;&lt;/el-switch&gt;</span><br><span class="line"> &lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更新开关的状态</span></span><br><span class="line">    updateBrandStatus(data) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"最新状态"</span>, data);</span><br><span class="line">      <span class="keyword">let</span> &#123;brandId,showStatus&#125; = data;</span><br><span class="line">      <span class="keyword">this</span>.$http(&#123;</span><br><span class="line">        url: <span class="keyword">this</span>.$http.adornUrl(<span class="string">"/product/brand/update"</span>),</span><br><span class="line">        method: <span class="string">"post"</span>,</span><br><span class="line">        data: <span class="keyword">this</span>.$http.adornData(&#123;brandId,showStatus&#125;, <span class="literal">false</span>)</span><br><span class="line">      &#125;).then(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.$message(&#123;</span><br><span class="line">          message: <span class="string">"状态更新成功"</span>,</span><br><span class="line">          type: <span class="string">"success"</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="添加上传"><a href="#添加上传" class="headerlink" title="添加上传"></a>添加上传</h3><p>和传统的单体应用不同，这里我们选择将数据上传到分布式文件服务器上。<br>这里我们选择将图片放置到阿里云上，使用对象存储。<br>阿里云上使使用对象存储方式：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338010-fa69b29e-a712-4c16-980e-620ee9f25322.png#align=left&amp;display=inline&amp;height=495&amp;margin=%5Bobject%20Object%5D&amp;originHeight=495&amp;originWidth=1276&amp;status=done&amp;style=none&amp;width=1276" alt><br>创建Bucket<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338058-a030ed06-1b0c-40cf-94a8-dced1c9c108d.png#align=left&amp;display=inline&amp;height=845&amp;margin=%5Bobject%20Object%5D&amp;originHeight=845&amp;originWidth=639&amp;status=done&amp;style=none&amp;width=639" alt><br>上传文件：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338113-f9ee394c-8169-4b15-9282-bc89e089a201.png#align=left&amp;display=inline&amp;height=270&amp;margin=%5Bobject%20Object%5D&amp;originHeight=270&amp;originWidth=1169&amp;status=done&amp;style=none&amp;width=1169" alt><br>上传成功后，取得图片的URL<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338160-6b4dd44f-1771-4c1c-a078-9cda1a7f38fb.png#align=left&amp;display=inline&amp;height=437&amp;margin=%5Bobject%20Object%5D&amp;originHeight=437&amp;originWidth=1340&amp;status=done&amp;style=none&amp;width=1340" alt><br>这种方式是手动上传图片，实际上我们可以在程序中设置自动上传图片到阿里云对象存储。<br>上传模型：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338207-790b0991-c495-41ca-9827-043e06e64630.png#align=left&amp;display=inline&amp;height=626&amp;margin=%5Bobject%20Object%5D&amp;originHeight=626&amp;originWidth=1063&amp;status=done&amp;style=none&amp;width=1063" alt><br>查看阿里云关于文件上传的帮助： <a href="https://help.aliyun.com/document_detail/32009.html?spm=a2c4g.11186623.6.768.549d59aaWuZMGJ" target="_blank" rel="noopener">https://help.aliyun.com/document_detail/32009.html?spm=a2c4g.11186623.6.768.549d59aaWuZMGJ</a></p>
<h4 id="1）添加依赖包"><a href="#1）添加依赖包" class="headerlink" title="1）添加依赖包"></a>1）添加依赖包</h4><p>在Maven项目中加入依赖项（推荐方式）<br>在 Maven 工程中使用 OSS Java SDK，只需在 pom.xml 中加入相应依赖即可。以 3.8.0 版本为例，在  内加入如下内容：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2）上传文件流"><a href="#2）上传文件流" class="headerlink" title="2）上传文件流"></a>2）上传文件流</h4><p>以下代码用于上传文件流：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span></span><br><span class="line">String endpoint = <span class="string">"http://oss-cn-hangzhou.aliyuncs.com"</span>;</span><br><span class="line"><span class="comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建。</span></span><br><span class="line">String accessKeyId = <span class="string">"&lt;yourAccessKeyId&gt;"</span>;</span><br><span class="line">String accessKeySecret = <span class="string">"&lt;yourAccessKeySecret&gt;"</span>;</span><br><span class="line"><span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">OSS ossClient = <span class="keyword">new</span> OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"><span class="comment">// 上传文件流。</span></span><br><span class="line">InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">"&lt;yourlocalFile&gt;"</span>);</span><br><span class="line">ossClient.putObject(<span class="string">"&lt;yourBucketName&gt;"</span>, <span class="string">"&lt;yourObjectName&gt;"</span>, inputStream);</span><br><span class="line"><span class="comment">// 关闭OSSClient。</span></span><br><span class="line">ossClient.shutdown();</span><br></pre></td></tr></table></figure></p>
<p>endpoint的取值：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338264-88c9b94b-f5df-49f7-9500-ec4761cd96b0.png#align=left&amp;display=inline&amp;height=241&amp;margin=%5Bobject%20Object%5D&amp;originHeight=241&amp;originWidth=1715&amp;status=done&amp;style=none&amp;width=1715" alt><br>accessKeyId和accessKeySecret需要创建一个RAM账号：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338302-b174253f-772e-4869-908a-bc5acf42dd49.png#align=left&amp;display=inline&amp;height=431&amp;margin=%5Bobject%20Object%5D&amp;originHeight=431&amp;originWidth=1062&amp;status=done&amp;style=none&amp;width=1062" alt><br>创建用户完毕后，会得到一个“AccessKey ID”和“AccessKeySecret”，然后复制这两个值到代码的“AccessKey ID”和“AccessKeySecret”。<br>另外还需要添加访问控制权限：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338350-fb2fd07b-f1bd-467a-b29a-116149d77c0a.png#align=left&amp;display=inline&amp;height=356&amp;margin=%5Bobject%20Object%5D&amp;originHeight=356&amp;originWidth=907&amp;status=done&amp;style=none&amp;width=907" alt><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span></span><br><span class="line">        String endpoint = <span class="string">"oss-cn-shanghai.aliyuncs.com"</span>;</span><br><span class="line">        <span class="comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建。</span></span><br><span class="line">        String accessKeyId = <span class="string">"LTAI4G4W1RA4JXz2QhoDwHhi"</span>;</span><br><span class="line">        String accessKeySecret = <span class="string">"R99lmDOJumF2x43ZBKT259Qpe70Oxw"</span>;</span><br><span class="line">        <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">        OSS ossClient = <span class="keyword">new</span> OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line">        <span class="comment">// 上传文件流。</span></span><br><span class="line">        InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">"C:\\Users\\Administrator\\Pictures\\timg.jpg"</span>);</span><br><span class="line">        ossClient.putObject(<span class="string">"gulimall-images"</span>, <span class="string">"time.jpg"</span>, inputStream);</span><br><span class="line">        <span class="comment">// 关闭OSSClient。</span></span><br><span class="line">        ossClient.shutdown();</span><br><span class="line">        System.out.println(<span class="string">"上传成功."</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>更为简单的使用方式，是使用SpringCloud Alibaba<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338415-600fabd3-ea74-4dca-8d00-cd16053cd0e6.png#align=left&amp;display=inline&amp;height=664&amp;margin=%5Bobject%20Object%5D&amp;originHeight=664&amp;originWidth=1303&amp;status=done&amp;style=none&amp;width=1303" alt><br>详细使用方法，见： <a href="https:_help.aliyun.com_knowledge_detail_108650" target="_blank" rel="noopener">https://help.aliyun.com/knowledge_detail/108650.html</a><br>（1）添加依赖<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>（2）创建“AccessKey ID”和“AccessKeySecret”<br>（3）配置key，secret和endpoint相关信息<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">access-key:</span> <span class="string">LTAI4G4W1RA4JXz2QhoDwHhi</span></span><br><span class="line">      <span class="attr">secret-key:</span> <span class="string">R99lmDOJumF2x43ZBKT259Qpe70Oxw</span></span><br><span class="line">      <span class="attr">oss:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">oss-cn-shanghai.aliyuncs.com</span></span><br></pre></td></tr></table></figure></p>
<p>（4）注入OSSClient并进行文件上传下载等操作<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338521-bf752315-b0fc-4722-8681-84c7ac1336e0.png#align=left&amp;display=inline&amp;height=405&amp;margin=%5Bobject%20Object%5D&amp;originHeight=405&amp;originWidth=1264&amp;status=done&amp;style=none&amp;width=1264" alt><br>但是这样来做还是比较麻烦，如果以后的上传任务都交给gulimall-product来完成，显然耦合度高。最好单独新建一个Module来完成文件上传任务。</p>
<h3 id="其他方式"><a href="#其他方式" class="headerlink" title="其他方式"></a>其他方式</h3><h4 id="1）新建gulimall-third-party"><a href="#1）新建gulimall-third-party" class="headerlink" title="1）新建gulimall-third-party"></a>1）新建gulimall-third-party</h4><h4 id="2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中"><a href="#2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中" class="headerlink" title="2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中"></a>2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.bigdata.gulimall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gulimall-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>另外也需要在“pom.xml”文件中，添加如下的依赖管理<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="3）在主启动类中开启服务的注册和发现"><a href="#3）在主启动类中开启服务的注册和发现" class="headerlink" title="3）在主启动类中开启服务的注册和发现"></a>3）在主启动类中开启服务的注册和发现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br></pre></td></tr></table></figure>
<h4 id="4）在nacos中注册"><a href="#4）在nacos中注册" class="headerlink" title="4）在nacos中注册"></a>4）在nacos中注册</h4><p>（1）创建命名空间“ gulimall-third-party ”<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338572-9975d2d4-62cb-4856-8a9e-43d75da5f085.png#align=left&amp;display=inline&amp;height=375&amp;margin=%5Bobject%20Object%5D&amp;originHeight=375&amp;originWidth=942&amp;status=done&amp;style=none&amp;width=942" alt><br>（2）在“ gulimall-third-party”命名空间中，创建“ gulimall-third-party.yml”文件<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">alicloud:</span></span><br><span class="line">      <span class="attr">access-key:</span> <span class="string">LTAI4G4W1RA4JXz2QhoDwHhi</span></span><br><span class="line">      <span class="attr">secret-key:</span> <span class="string">R99lmDOJumF2x43ZBKT259Qpe70Oxw</span></span><br><span class="line">      <span class="attr">oss:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">oss-cn-shanghai.aliyuncs.com</span></span><br></pre></td></tr></table></figure></p>
<h4 id="5）编写配置文件"><a href="#5）编写配置文件" class="headerlink" title="5）编写配置文件"></a>5）编写配置文件</h4><p>application.yml<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">30000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-third-party</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.14</span><span class="string">:8848</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.bigdata.gulimall.product:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure></p>
<p>bootstrap.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.config.name=gulimall-third-party</span><br><span class="line">spring.cloud.nacos.config.server-addr=192.168.137.14:8848</span><br><span class="line">spring.cloud.nacos.config.namespace=f995d8ee-c53a-4d29-8316-a1ef54775e00</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].data-id=gulimall-third-party.yml</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].group=DEFAULT_GROUP</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].refresh=true</span><br></pre></td></tr></table></figure></p>
<h4 id="6）-编写测试类"><a href="#6）-编写测试类" class="headerlink" title="6） 编写测试类"></a>6） 编写测试类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bigdata.gulimall.thirdparty;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSS;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GulimallThirdPartyApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OSSClient ossClient;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span></span><br><span class="line">        String endpoint = <span class="string">"oss-cn-shanghai.aliyuncs.com"</span>;</span><br><span class="line">        <span class="comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建。</span></span><br><span class="line">        String accessKeyId = <span class="string">"LTAI4G4W1RA4JXz2QhoDwHhi"</span>;</span><br><span class="line">        String accessKeySecret = <span class="string">"R99lmDOJumF2x43ZBKT259Qpe70Oxw"</span>;</span><br><span class="line">        <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">        OSS ossClient = <span class="keyword">new</span> OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line">         <span class="comment">//上传文件流。</span></span><br><span class="line">        InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">"C:\\Users\\Administrator\\Pictures\\timg.jpg"</span>);</span><br><span class="line">        ossClient.putObject(<span class="string">"gulimall-images"</span>, <span class="string">"time3.jpg"</span>, inputStream);</span><br><span class="line">        <span class="comment">// 关闭OSSClient。</span></span><br><span class="line">        ossClient.shutdown();</span><br><span class="line">        System.out.println(<span class="string">"上传成功."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://help.aliyun.com/document_detail/31926.html?spm=a2c4g.11186623.6.1527.228d74b8V6IZuT" target="_blank" rel="noopener">https://help.aliyun.com/document_detail/31926.html?spm=a2c4g.11186623.6.1527.228d74b8V6IZuT</a><br><strong>背景</strong><br>采用JavaScript客户端直接签名（参见<a href="https://help.aliyun.com/document_detail/31925.html#concept-frd-4gy-5db" target="_blank" rel="noopener">JavaScript客户端签名直传</a>）时，AccessKeyID和AcessKeySecret会暴露在前端页面，因此存在严重的安全隐患。因此，OSS提供了服务端签名后直传的方案。<br><strong>原理介绍</strong><br><a href="http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/6875011751/p1472.png" target="_blank" rel="noopener"><img src="https://cdn.nlark.com/yuque/0/2020/png/1033455/1592614256788-be8554d9-1db3-4916-ad64-879b65888125.png#align=left&amp;display=inline&amp;height=323&amp;margin=%5Bobject%20Object%5D&amp;originHeight=323&amp;originWidth=692&amp;size=0&amp;status=done&amp;style=none&amp;width=692" alt></a><br>服务端签名后直传的原理如下：</p>
<ol>
<li>用户发送上传Policy请求到应用服务器。</li>
<li>应用服务器返回上传Policy和签名给用户。</li>
<li>用户直接上传数据到OSS。</li>
</ol>
<p>编写“com.bigdata.gulimall.thirdparty.controller.OssController”类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bigdata.gulimall.thirdparty.controller;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSS;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.utils.BinaryUtil;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.model.MatchMode;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.model.PolicyConditions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OssController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OSS ossClient;</span><br><span class="line">    <span class="meta">@Value</span> (<span class="string">"$&#123;spring.cloud.alicloud.oss.endpoint&#125;"</span>)</span><br><span class="line">    String endpoint ;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.cloud.alicloud.oss.bucket&#125;"</span>)</span><br><span class="line">    String bucket ;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.cloud.alicloud.access-key&#125;"</span>)</span><br><span class="line">    String accessId ;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.cloud.alicloud.secret-key&#125;"</span>)</span><br><span class="line">    String accessKey ;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/oss/policy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">policy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String host = <span class="string">"https://"</span> + bucket + <span class="string">"."</span> + endpoint; <span class="comment">// host的格式为 bucketname.endpoint</span></span><br><span class="line">        String format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line">        String dir = format; <span class="comment">// 用户上传文件时指定的前缀。</span></span><br><span class="line">        Map&lt;String, String&gt; respMap=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">long</span> expireTime = <span class="number">30</span>;</span><br><span class="line">            <span class="keyword">long</span> expireEndTime = System.currentTimeMillis() + expireTime * <span class="number">1000</span>;</span><br><span class="line">            Date expiration = <span class="keyword">new</span> Date(expireEndTime);</span><br><span class="line">            PolicyConditions policyConds = <span class="keyword">new</span> PolicyConditions();</span><br><span class="line">            policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE, <span class="number">0</span>, <span class="number">1048576000</span>);</span><br><span class="line">            policyConds.addConditionItem(MatchMode.StartWith, PolicyConditions.COND_KEY, dir);</span><br><span class="line">            String postPolicy = ossClient.generatePostPolicy(expiration, policyConds);</span><br><span class="line">            <span class="keyword">byte</span>[] binaryData = postPolicy.getBytes(<span class="string">"utf-8"</span>);</span><br><span class="line">            String encodedPolicy = BinaryUtil.toBase64String(binaryData);</span><br><span class="line">            String postSignature = ossClient.calculatePostSignature(postPolicy);</span><br><span class="line">            respMap= <span class="keyword">new</span> LinkedHashMap&lt;String, String&gt;();</span><br><span class="line">            respMap.put(<span class="string">"accessid"</span>, accessId);</span><br><span class="line">            respMap.put(<span class="string">"policy"</span>, encodedPolicy);</span><br><span class="line">            respMap.put(<span class="string">"signature"</span>, postSignature);</span><br><span class="line">            respMap.put(<span class="string">"dir"</span>, dir);</span><br><span class="line">            respMap.put(<span class="string">"host"</span>, host);</span><br><span class="line">            respMap.put(<span class="string">"expire"</span>, String.valueOf(expireEndTime / <span class="number">1000</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// Assert.fail(e.getMessage());</span></span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> respMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试： <a href="http://localhost:30000/oss/policy" target="_blank" rel="noopener">http://localhost:30000/oss/policy</a><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"accessid"</span>:<span class="string">"LTAI4G4W1RA4JXz2QhoDwHhi"</span>,<span class="attr">"policy"</span>:<span class="string">"eyJleHBpcmF0aW9uIjoiMjAyMC0wNC0yOVQwMjo1ODowNy41NzhaIiwiY29uZGl0aW9ucyI6W1siY29udGVudC1sZW5ndGgtcmFuZ2UiLDAsMTA0ODU3NjAwMF0sWyJzdGFydHMtd2l0aCIsIiRrZXkiLCIyMDIwLTA0LTI5LyJdXX0="</span>,<span class="attr">"signature"</span>:<span class="string">"s42iRxtxGFmHyG40StM3d9vOfFk="</span>,<span class="attr">"dir"</span>:<span class="string">"2020-04-29/"</span>,<span class="attr">"host"</span>:<span class="string">"https://gulimall-images.oss-cn-shanghai.aliyuncs.com"</span>,<span class="attr">"expire"</span>:<span class="string">"1588129087"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>以后在上传文件时的访问路径为“ <a href="http://localhost:88/api/thirdparty/oss/policy”，" target="_blank" rel="noopener">http://localhost:88/api/thirdparty/oss/policy”，</a><br>在“gulimall-gateway”中配置路由规则：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">third_party_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-gateway</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/thirdparty/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/thirdparty/(?&lt;segment&gt;/?.*),/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>测试是否能够正常跳转： <a href="http://localhost:88/api/thirdparty/oss/policy" target="_blank" rel="noopener">http://localhost:88/api/thirdparty/oss/policy</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338630-6b7278b4-25f1-4e0c-a7f1-5cec9e453c62.png#align=left&amp;display=inline&amp;height=324&amp;margin=%5Bobject%20Object%5D&amp;originHeight=324&amp;originWidth=1112&amp;status=done&amp;style=none&amp;width=1112" alt></p>
<h3 id="上传组件"><a href="#上传组件" class="headerlink" title="上传组件"></a>上传组件</h3><p>放置项目提供的upload文件夹到components目录下，一个是单文件上传，另外一个是多文件上传<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Project\gulimall\renren-fast-vue\src\components\upload&gt; ls</span><br><span class="line">    目录: D:\Project\gulimall\renren-fast-vue\src\components\upload</span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----  2020/4/29 星期三     12:0           3122 multiUpload.vue</span><br><span class="line">                                2</span><br><span class="line">-a----  2019/11/11 星期一     21:            343 policy.js</span><br><span class="line">                               20</span><br><span class="line">-a----  2020/4/29 星期三     12:0           3053 singleUpload.vue</span><br><span class="line">                                1</span><br><span class="line">PS D:\Project\gulimall\renren-fast-vue\src\components\upload&gt;</span><br></pre></td></tr></table></figure></p>
<p>修改这两个文件的配置后<br>开始执行上传，但是在上传过程中，出现了如下的问题：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338677-4f3196df-ae7e-4b30-88c2-cbe46c4632e1.png#align=left&amp;display=inline&amp;height=72&amp;margin=%5Bobject%20Object%5D&amp;originHeight=72&amp;originWidth=1729&amp;status=done&amp;style=none&amp;width=1729" alt><br><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Access</span> <span class="keyword">to</span> XMLHttpRequest at <span class="symbol">'http</span>://gulimall-images.oss-cn-shanghai.aliyuncs.com/' from origin <span class="symbol">'http</span>://localhost:<span class="number">8001</span>' has been blocked by CORS policy: Response <span class="keyword">to</span> preflight request doesn<span class="symbol">'t</span> pass <span class="keyword">access</span> control check: No <span class="symbol">'Access</span>-Control-Allow-Origin' header <span class="keyword">is</span> present <span class="keyword">on</span> the requested resource.</span><br></pre></td></tr></table></figure></p>
<p>这又是一个跨域的问题，解决方法就是在阿里云上开启跨域访问：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338714-c99d4d6f-413b-4c1e-9897-4ab65195f98e.png#align=left&amp;display=inline&amp;height=616&amp;margin=%5Bobject%20Object%5D&amp;originHeight=616&amp;originWidth=1861&amp;status=done&amp;style=none&amp;width=1861" alt><br>再次执行文件上传。</p>
<h2 id="18-JSR303校验"><a href="#18-JSR303校验" class="headerlink" title="18. JSR303校验"></a>18. JSR303校验</h2><h3 id="步骤1：使用校验注解"><a href="#步骤1：使用校验注解" class="headerlink" title="步骤1：使用校验注解"></a>步骤1：使用校验注解</h3><p>在Java中提供了一系列的校验方式，它这些校验方式在“javax.validation.constraints”包中，提供了如@Email，@NotNull等注解。<br>在非空处理方式上提供了@NotNull，@Blank和@<br>（1）<a href="https://www.yuque.com/NotNull" target="_blank" rel="noopener">_@_NotNull </a><br>The annotated element must not be null. Accepts any type.<br>注解元素禁止为null，能够接收任何类型<br>（2）<a href="https://www.yuque.com/NotEmpty" target="_blank" rel="noopener">_@_NotEmpty </a><br>the annotated element must not be null nor empty.<br>该注解修饰的字段不能为null或””<br>Supported types are:<br>支持以下几种类型<br>CharSequence (length of character sequence is evaluated)<br>字符序列（字符序列长度的计算）<br>Collection (collection size is evaluated)<br>集合长度的计算<br>Map (map size is evaluated)<br>map长度的计算<br>Array (array length is evaluated)<br>数组长度的计算<br>（3）<a href="https://www.yuque.com/NotBlank" target="_blank" rel="noopener">_@_NotBlank </a><br>The annotated element must not be null and must contain at least one non-whitespace character. Accepts CharSequence.<br>该注解不能为null，并且至少包含一个非空白字符。接收字符序列。</p>
<h3 id="步骤2：在请求方法种，使用校验注解-Valid，开启校验，"><a href="#步骤2：在请求方法种，使用校验注解-Valid，开启校验，" class="headerlink" title="步骤2：在请求方法种，使用校验注解@Valid，开启校验，"></a>步骤2：在请求方法种，使用校验注解@Valid，开启校验，</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(@Valid @RequestBody BrandEntity brand)</span></span>&#123;</span><br><span class="line">		brandService.save(brand);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>测试： <a href="http://localhost:88/api/product/brand/save" target="_blank" rel="noopener">http://localhost:88/api/product/brand/save</a><br>在postman种发送上面的请求<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="string">"2020-04-29T09:20:46.383+0000"</span>,</span><br><span class="line">    <span class="attr">"status"</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"Bad Request"</span>,</span><br><span class="line">    <span class="attr">"errors"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"codes"</span>: [</span><br><span class="line">                <span class="string">"NotBlank.brandEntity.name"</span>,</span><br><span class="line">                <span class="string">"NotBlank.name"</span>,</span><br><span class="line">                <span class="string">"NotBlank.java.lang.String"</span>,</span><br><span class="line">                <span class="string">"NotBlank"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"arguments"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"codes"</span>: [</span><br><span class="line">                        <span class="string">"brandEntity.name"</span>,</span><br><span class="line">                        <span class="string">"name"</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">"arguments"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">"defaultMessage"</span>: <span class="string">"name"</span>,</span><br><span class="line">                    <span class="attr">"code"</span>: <span class="string">"name"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"defaultMessage"</span>: <span class="string">"不能为空"</span>,</span><br><span class="line">            <span class="attr">"objectName"</span>: <span class="string">"brandEntity"</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"name"</span>,</span><br><span class="line">            <span class="attr">"rejectedValue"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"bindingFailure"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"code"</span>: <span class="string">"NotBlank"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"Validation failed for object='brandEntity'. Error count: 1"</span>,</span><br><span class="line">    <span class="attr">"path"</span>: <span class="string">"/product/brand/save"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>能够看到”defaultMessage”: “不能为空”，这些错误消息定义在“hibernate-validator”的“\org\hibernate\validator\ValidationMessages_zh_CN.properties”文件中。在该文件中定义了很多的错误规则：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">javax.validation.constraints.AssertFalse.message     = 只能为false</span><br><span class="line">javax.validation.constraints.AssertTrue.message      = 只能为true</span><br><span class="line">javax.validation.constraints.DecimalMax.message      = 必须小于或等于&#123;value&#125;</span><br><span class="line">javax.validation.constraints.DecimalMin.message      = 必须大于或等于&#123;value&#125;</span><br><span class="line">javax.validation.constraints.Digits.message          = 数字的值超出了允许范围(只允许在&#123;integer&#125;位整数和&#123;fraction&#125;位小数范围内)</span><br><span class="line">javax.validation.constraints.Email.message           = 不是一个合法的电子邮件地址</span><br><span class="line">javax.validation.constraints.Future.message          = 需要是一个将来的时间</span><br><span class="line">javax.validation.constraints.FutureOrPresent.message = 需要是一个将来或现在的时间</span><br><span class="line">javax.validation.constraints.Max.message             = 最大不能超过&#123;value&#125;</span><br><span class="line">javax.validation.constraints.Min.message             = 最小不能小于&#123;value&#125;</span><br><span class="line">javax.validation.constraints.Negative.message        = 必须是负数</span><br><span class="line">javax.validation.constraints.NegativeOrZero.message  = 必须是负数或零</span><br><span class="line">javax.validation.constraints.NotBlank.message        = 不能为空</span><br><span class="line">javax.validation.constraints.NotEmpty.message        = 不能为空</span><br><span class="line">javax.validation.constraints.NotNull.message         = 不能为null</span><br><span class="line">javax.validation.constraints.Null.message            = 必须为null</span><br><span class="line">javax.validation.constraints.Past.message            = 需要是一个过去的时间</span><br><span class="line">javax.validation.constraints.PastOrPresent.message   = 需要是一个过去或现在的时间</span><br><span class="line">javax.validation.constraints.Pattern.message         = 需要匹配正则表达式&quot;&#123;regexp&#125;&quot;</span><br><span class="line">javax.validation.constraints.Positive.message        = 必须是正数</span><br><span class="line">javax.validation.constraints.PositiveOrZero.message  = 必须是正数或零</span><br><span class="line">javax.validation.constraints.Size.message            = 个数必须在&#123;min&#125;和&#123;max&#125;之间</span><br><span class="line">org.hibernate.validator.constraints.CreditCardNumber.message        = 不合法的信用卡号码</span><br><span class="line">org.hibernate.validator.constraints.Currency.message                = 不合法的货币 (必须是&#123;value&#125;其中之一)</span><br><span class="line">org.hibernate.validator.constraints.EAN.message                     = 不合法的&#123;type&#125;条形码</span><br><span class="line">org.hibernate.validator.constraints.Email.message                   = 不是一个合法的电子邮件地址</span><br><span class="line">org.hibernate.validator.constraints.Length.message                  = 长度需要在&#123;min&#125;和&#123;max&#125;之间</span><br><span class="line">org.hibernate.validator.constraints.CodePointLength.message         = 长度需要在&#123;min&#125;和&#123;max&#125;之间</span><br><span class="line">org.hibernate.validator.constraints.LuhnCheck.message               = $&#123;validatedValue&#125;的校验码不合法, Luhn模10校验和不匹配</span><br><span class="line">org.hibernate.validator.constraints.Mod10Check.message              = $&#123;validatedValue&#125;的校验码不合法, 模10校验和不匹配</span><br><span class="line">org.hibernate.validator.constraints.Mod11Check.message              = $&#123;validatedValue&#125;的校验码不合法, 模11校验和不匹配</span><br><span class="line">org.hibernate.validator.constraints.ModCheck.message                = $&#123;validatedValue&#125;的校验码不合法, $&#123;modType&#125;校验和不匹配</span><br><span class="line">org.hibernate.validator.constraints.NotBlank.message                = 不能为空</span><br><span class="line">org.hibernate.validator.constraints.NotEmpty.message                = 不能为空</span><br><span class="line">org.hibernate.validator.constraints.ParametersScriptAssert.message  = 执行脚本表达式&quot;&#123;script&#125;&quot;没有返回期望结果</span><br><span class="line">org.hibernate.validator.constraints.Range.message                   = 需要在&#123;min&#125;和&#123;max&#125;之间</span><br><span class="line">org.hibernate.validator.constraints.SafeHtml.message                = 可能有不安全的HTML内容</span><br><span class="line">org.hibernate.validator.constraints.ScriptAssert.message            = 执行脚本表达式&quot;&#123;script&#125;&quot;没有返回期望结果</span><br><span class="line">org.hibernate.validator.constraints.URL.message                     = 需要是一个合法的URL</span><br><span class="line">org.hibernate.validator.constraints.time.DurationMax.message        = 必须小于$&#123;inclusive == true ? &apos;或等于&apos; : &apos;&apos;&#125;$&#123;days == 0 ? &apos;&apos; : days += &apos;天&apos;&#125;$&#123;hours == 0 ? &apos;&apos; : hours += &apos;小时&apos;&#125;$&#123;minutes == 0 ? &apos;&apos; : minutes += &apos;分钟&apos;&#125;$&#123;seconds == 0 ? &apos;&apos; : seconds += &apos;秒&apos;&#125;$&#123;millis == 0 ? &apos;&apos; : millis += &apos;毫秒&apos;&#125;$&#123;nanos == 0 ? &apos;&apos; : nanos += &apos;纳秒&apos;&#125;</span><br><span class="line">org.hibernate.validator.constraints.time.DurationMin.message        = 必须大于$&#123;inclusive == true ? &apos;或等于&apos; : &apos;&apos;&#125;$&#123;days == 0 ? &apos;&apos; : days += &apos;天&apos;&#125;$&#123;hours == 0 ? &apos;&apos; : hours += &apos;小时&apos;&#125;$&#123;minutes == 0 ? &apos;&apos; : minutes += &apos;分钟&apos;&#125;$&#123;seconds == 0 ? &apos;&apos; : seconds += &apos;秒&apos;&#125;$&#123;millis == 0 ? &apos;&apos; : millis += &apos;毫秒&apos;&#125;$&#123;nanos == 0 ? &apos;&apos; : nanos += &apos;纳秒&apos;&#125;</span><br></pre></td></tr></table></figure></p>
<p>想要自定义错误消息，可以覆盖默认的错误提示信息，如@NotBlank的默认message是<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> NotBlank &#123;</span><br><span class="line">	<span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> "</span>&#123;javax.validation.constraints.NotBlank.message&#125;<span class="string">";</span></span><br></pre></td></tr></table></figure></p>
<p>可以在添加注解的时候，修改message：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotBlank</span>(message = <span class="string">"品牌名必须非空"</span>)</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure></p>
<p>当再次发送请求时，得到的错误提示信息：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="string">"2020-04-29T09:36:04.125+0000"</span>,</span><br><span class="line">    <span class="attr">"status"</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"Bad Request"</span>,</span><br><span class="line">    <span class="attr">"errors"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"codes"</span>: [</span><br><span class="line">                <span class="string">"NotBlank.brandEntity.name"</span>,</span><br><span class="line">                <span class="string">"NotBlank.name"</span>,</span><br><span class="line">                <span class="string">"NotBlank.java.lang.String"</span>,</span><br><span class="line">                <span class="string">"NotBlank"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"arguments"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"codes"</span>: [</span><br><span class="line">                        <span class="string">"brandEntity.name"</span>,</span><br><span class="line">                        <span class="string">"name"</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">"arguments"</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">"defaultMessage"</span>: <span class="string">"name"</span>,</span><br><span class="line">                    <span class="attr">"code"</span>: <span class="string">"name"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"defaultMessage"</span>: <span class="string">"品牌名必须非空"</span>,</span><br><span class="line">            <span class="attr">"objectName"</span>: <span class="string">"brandEntity"</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"name"</span>,</span><br><span class="line">            <span class="attr">"rejectedValue"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"bindingFailure"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"code"</span>: <span class="string">"NotBlank"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"Validation failed for object='brandEntity'. Error count: 1"</span>,</span><br><span class="line">    <span class="attr">"path"</span>: <span class="string">"/product/brand/save"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但是这种返回的错误结果并不符合我们的业务需要。</p>
<h3 id="步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。"><a href="#步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。" class="headerlink" title="步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。"></a>步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(@Valid @RequestBody BrandEntity brand, BindingResult result)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( result.hasErrors())&#123;</span><br><span class="line">            Map&lt;String,String&gt; map=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            <span class="comment">//1.获取错误的校验结果</span></span><br><span class="line">            result.getFieldErrors().forEach((item)-&gt;&#123;</span><br><span class="line">                <span class="comment">//获取发生错误时的message</span></span><br><span class="line">                String message = item.getDefaultMessage();</span><br><span class="line">                <span class="comment">//获取发生错误的字段</span></span><br><span class="line">                String field = item.getField();</span><br><span class="line">                map.put(field,message);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="number">400</span>,<span class="string">"提交的数据不合法"</span>).put(<span class="string">"data"</span>,map);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">		brandService.save(brand);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这种是针对于该请求设置了一个内容校验，如果针对于每个请求都单独进行配置，显然不是太合适，实际上可以统一的对于异常进行处理。</p>
<h3 id="步骤4：统一异常处理"><a href="#步骤4：统一异常处理" class="headerlink" title="步骤4：统一异常处理"></a>步骤4：统一异常处理</h3><p>可以使用SpringMvc所提供的@ControllerAdvice，通过“basePackages”能够说明处理哪些路径下的异常。<br>（1）抽取一个异常处理类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bigdata.gulimall.product.exception;</span><br><span class="line"><span class="keyword">import</span> com.bigdata.common.utils.R;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.BindingResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.MethodArgumentNotValidException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 集中处理所有异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestControllerAdvice</span>(basePackages = <span class="string">"com.bigdata.gulimall.product.controller"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GulimallExceptionAdvice</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(value = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">R</span> <span class="title">handleValidException</span>(<span class="title">MethodArgumentNotValidException</span> <span class="title">exception</span>)</span>&#123;</span><br><span class="line">        Map&lt;String,String&gt; map=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        BindingResult bindingResult = exception.getBindingResult();</span><br><span class="line">        bindingResult.getFieldErrors().forEach(fieldError -&gt; &#123;</span><br><span class="line">            String message = fieldError.getDefaultMessage();</span><br><span class="line">            String field = fieldError.getField();</span><br><span class="line">            map.put(field,message);</span><br><span class="line">        &#125;);</span><br><span class="line">        log.error(<span class="string">"数据校验出现问题&#123;&#125;,异常类型&#123;&#125;"</span>,exception.getMessage(),exception.getClass());</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="number">400</span>,<span class="string">"数据校验出现问题"</span>).put(<span class="string">"data"</span>,map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>（2）测试： <a href="http://localhost:88/api/product/brand/save" target="_blank" rel="noopener">http://localhost:88/api/product/brand/save</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338804-30181ab4-459e-419a-9579-897e642879fe.png#align=left&amp;display=inline&amp;height=657&amp;margin=%5Bobject%20Object%5D&amp;originHeight=657&amp;originWidth=1096&amp;status=done&amp;style=none&amp;width=1096" alt><br>（3）默认异常处理<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span>(value = Throwable<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">R</span> <span class="title">handleException</span>(<span class="title">Throwable</span> <span class="title">throwable</span>)</span>&#123;</span><br><span class="line">        log.error(<span class="string">"未知异常&#123;&#125;,异常类型&#123;&#125;"</span>,throwable.getMessage(),throwable.getClass());</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnum.UNKNOW_EXEPTION.getCode(),BizCodeEnum.UNKNOW_EXEPTION.getMsg());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>（4）错误状态码<br>上面代码中，针对于错误状态码，是我们进行随意定义的，然而正规开发过程中，错误状态码有着严格的定义规则，如该在项目中我们的错误状态码定义<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341338879-9811727e-e6fa-447d-9993-7927a65c999b.png#align=left&amp;display=inline&amp;height=671&amp;margin=%5Bobject%20Object%5D&amp;originHeight=671&amp;originWidth=1056&amp;status=done&amp;style=none&amp;width=1056" alt><br>为了定义这些错误状态码，我们可以单独定义一个常量类，用来存储这些错误状态码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bigdata.common.exception;</span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 错误码和错误信息定义类</span></span><br><span class="line"><span class="comment"> * 1. 错误码定义规则为5为数字</span></span><br><span class="line"><span class="comment"> * 2. 前两位表示业务场景，最后三位表示错误码。例如：100001。10:通用 001:系统未知异常</span></span><br><span class="line"><span class="comment"> * 3. 维护错误码后需要维护错误描述，将他们定义为枚举形式</span></span><br><span class="line"><span class="comment"> * 错误码列表：</span></span><br><span class="line"><span class="comment"> *  10: 通用</span></span><br><span class="line"><span class="comment"> *      001：参数格式校验</span></span><br><span class="line"><span class="comment"> *  11: 商品</span></span><br><span class="line"><span class="comment"> *  12: 订单</span></span><br><span class="line"><span class="comment"> *  13: 购物车</span></span><br><span class="line"><span class="comment"> *  14: 物流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> BizCodeEnum &#123;</span><br><span class="line">    UNKNOW_EXEPTION(<span class="number">10000</span>,<span class="string">"系统未知异常"</span>),</span><br><span class="line">    VALID_EXCEPTION( <span class="number">10001</span>,<span class="string">"参数格式校验失败"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    BizCodeEnum(<span class="keyword">int</span> code, String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>（5）测试： <a href="http://localhost:88/api/product/brand/save" target="_blank" rel="noopener">http://localhost:88/api/product/brand/save</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341339001-f58f5819-5fbc-4c9a-b991-f49d34c6fd96.png#align=left&amp;display=inline&amp;height=654&amp;margin=%5Bobject%20Object%5D&amp;originHeight=654&amp;originWidth=843&amp;status=done&amp;style=none&amp;width=843" alt></p>
<h2 id="19-分组校验功能（完成多场景的复杂校验）"><a href="#19-分组校验功能（完成多场景的复杂校验）" class="headerlink" title="19. 分组校验功能（完成多场景的复杂校验）"></a>19. 分组校验功能（完成多场景的复杂校验）</h2><h3 id="1、给校验注解，标注上groups，指定什么情况下才需要进行校验"><a href="#1、给校验注解，标注上groups，指定什么情况下才需要进行校验" class="headerlink" title="1、给校验注解，标注上groups，指定什么情况下才需要进行校验"></a>1、给校验注解，标注上groups，指定什么情况下才需要进行校验</h3><p>如：指定在更新和添加的时候，都需要进行校验<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotEmpty</span></span><br><span class="line">	<span class="meta">@NotBlank</span>(message = <span class="string">"品牌名必须非空"</span>,groups = &#123;UpdateGroup<span class="class">.<span class="keyword">class</span>,<span class="title">AddGroup</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">	<span class="title">private</span> <span class="title">String</span> <span class="title">name</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>在这种情况下，没有指定分组的校验注解，默认是不起作用的。想要起作用就必须要加groups。</p>
<h3 id="2、业务方法参数上使用-Validated注解"><a href="#2、业务方法参数上使用-Validated注解" class="headerlink" title="2、业务方法参数上使用@Validated注解"></a>2、业务方法参数上使用@Validated注解</h3><p>@Validated的value方法：<br>Specify one or more validation groups to apply to the validation step kicked off by this annotation.<br>指定一个或多个验证组以应用于此注释启动的验证步骤。<br>JSR-303 defines validation groups as custom annotations which an application declares for the sole purpose of using<br>them as type-safe group arguments, as implemented in SpringValidatorAdapter.<br>JSR-303 将验证组定义为自定义注释，应用程序声明的唯一目的是将它们用作类型安全组参数，如 SpringValidatorAdapter 中实现的那样。<br>Other SmartValidator implementations may support class arguments in other ways as well.<br>其他SmartValidator 实现也可以以其他方式支持类参数。</p>
<h3 id="3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。"><a href="#3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。" class="headerlink" title="3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。"></a>3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。</h3><h2 id="20-自定义校验功能"><a href="#20-自定义校验功能" class="headerlink" title="20. 自定义校验功能"></a>20. 自定义校验功能</h2><h3 id="1、编写一个自定义的校验注解"><a href="#1、编写一个自定义的校验注解" class="headerlink" title="1、编写一个自定义的校验注解"></a>1、编写一个自定义的校验注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint</span>(validatedBy = &#123; ListValueConstraintValidator<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">@<span class="title">Target</span>(</span>&#123; METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE &#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ListValue &#123;</span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> "</span>&#123;com.bigdata.common.valid.ListValue.message&#125;<span class="string">";</span></span><br><span class="line"><span class="string">    Class&lt;?&gt;[] groups() default &#123; &#125;;</span></span><br><span class="line"><span class="string">    Class&lt;? extends Payload&gt;[] payload() default &#123; &#125;;</span></span><br><span class="line"><span class="string">    int[] value() default &#123;&#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="2、编写一个自定义的校验器"><a href="#2、编写一个自定义的校验器" class="headerlink" title="2、编写一个自定义的校验器"></a>2、编写一个自定义的校验器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListValueConstraintValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">ListValue</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Integer&gt; set=<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(ListValue constraintAnnotation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] value = constraintAnnotation.value();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : value) &#123;</span><br><span class="line">            set.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(Integer value, ConstraintValidatorContext context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  set.contains(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、关联自定义的校验器和自定义的校验注解"><a href="#3、关联自定义的校验器和自定义的校验注解" class="headerlink" title="3、关联自定义的校验器和自定义的校验注解"></a>3、关联自定义的校验器和自定义的校验注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Constraint</span>(validatedBy = &#123; ListValueConstraintValidator<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br></pre></td></tr></table></figure>
<h3 id="4、使用实例"><a href="#4、使用实例" class="headerlink" title="4、使用实例"></a>4、使用实例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@ListValue</span>(value = &#123;<span class="number">0</span>,<span class="number">1</span>&#125;,groups =&#123;AddGroup<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">	<span class="title">private</span> <span class="title">Integer</span> <span class="title">showStatus</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="21-商品SPU和SKU管理"><a href="#21-商品SPU和SKU管理" class="headerlink" title="21. 商品SPU和SKU管理"></a>21. 商品SPU和SKU管理</h2><p>重新执行“sys_menus.sql”</p>
<h2 id="22-点击子组件，父组件触发事件"><a href="#22-点击子组件，父组件触发事件" class="headerlink" title="22. 点击子组件，父组件触发事件"></a>22. 点击子组件，父组件触发事件</h2><p>现在想要实现点击菜单的左边，能够实现在右边展示数据<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341339142-ba90138e-60aa-4a03-9d11-f04f77cd94ba.png#align=left&amp;display=inline&amp;height=321&amp;margin=%5Bobject%20Object%5D&amp;originHeight=321&amp;originWidth=1572&amp;status=done&amp;style=none&amp;width=1572" alt><br>父子组件传递数据：<br>1）子组件给父组件传递数据，事件机制；<br>在category中绑定node-click事件，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tree :data=&quot;menus&quot; :props=&quot;defaultProps&quot; node-key=&quot;catId&quot; ref=&quot;menuTree&quot; @node-click=&quot;nodeClick&quot;	&gt;&lt;/el-tree&gt;</span><br></pre></td></tr></table></figure></p>
<p>2）子组件给父组件发送一个事件，携带上数据；<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nodeClick(data,Node,component)&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">"子组件"</span>,data,Node,component);</span><br><span class="line">       <span class="keyword">this</span>.$emit(<span class="string">"tree-node-click"</span>,data,Node,component);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></p>
<p>this.$emit(事件名,”携带的数据”);<br>3）父组件中的获取发送的事件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;category @tree-node-click=&quot;treeNodeClick&quot;&gt;&lt;/category&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取发送的事件数据</span></span><br><span class="line">    treeNodeClick(data,Node,component)&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">"attgroup感知到的category的节点被点击"</span>,data,Node,component);</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">"刚才被点击的菜单ID"</span>,data.catId);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h2 id="23-规格参数新增与VO"><a href="#23-规格参数新增与VO" class="headerlink" title="23. 规格参数新增与VO"></a>23. 规格参数新增与VO</h2><p>规格参数新增时，请求的URL：Request URL:<br><a href="http://localhost:88/api/product/attr/base/list/0?t=1588731762158&amp;page=1&amp;limit=10&amp;key=" target="_blank" rel="noopener">http://localhost:88/api/product/attr/base/list/0?t=1588731762158&amp;page=1&amp;limit=10&amp;key=</a><br>当有新增字段时，我们往往会在entity实体类中新建一个字段，并标注数据库中不存在该字段，然而这种方式并不规范<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341339210-e43fa4eb-edbf-45b5-984d-3abe6edb54c7.png#align=left&amp;display=inline&amp;height=364&amp;margin=%5Bobject%20Object%5D&amp;originHeight=364&amp;originWidth=1106&amp;status=done&amp;style=none&amp;width=1106" alt><br>比较规范的做法是，新建一个vo文件夹，将每种不同的对象，按照它的功能进行了划分。在java中，涉及到了这几种类型<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341339273-d53a43f2-39e1-4999-ba4b-acc4b1c0b15f.png#align=left&amp;display=inline&amp;height=577&amp;margin=%5Bobject%20Object%5D&amp;originHeight=577&amp;originWidth=1378&amp;status=done&amp;style=none&amp;width=1378" alt><br>Request URL: <a href="http://localhost:88/api/product/attr/save，现在的情况是，它在保存的时候，只是保存了attr，并没有保存attrgroup，为了解决这个问题，我们新建了一个vo/AttrVo，在原AttrEntity基础上增加了attrGroupId字段，使得保存新增数据的时候，也保存了它们之间的关系。" target="_blank" rel="noopener">http://localhost:88/api/product/attr/save，现在的情况是，它在保存的时候，只是保存了attr，并没有保存attrgroup，为了解决这个问题，我们新建了一个vo/AttrVo，在原AttrEntity基础上增加了attrGroupId字段，使得保存新增数据的时候，也保存了它们之间的关系。</a><br>通过” BeanUtils.copyProperties(attr,attrEntity);”能够实现在两个Bean之间拷贝数据，但是两个Bean的字段要相同<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAttr</span><span class="params">(AttrVo attr)</span> </span>&#123;</span><br><span class="line">        AttrEntity attrEntity = <span class="keyword">new</span> AttrEntity();</span><br><span class="line">        BeanUtils.copyProperties(attr,attrEntity);</span><br><span class="line">        <span class="keyword">this</span>.save(attrEntity);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>问题：现在有两个查询，一个是查询部分，另外一个是查询全部，但是又必须这样来做吗？还是有必要的，但是可以在后台进行设计，两种查询是根据catId是否为零进行区分的。</p>
<h2 id="24-查询分组关联属性和删除关联"><a href="#24-查询分组关联属性和删除关联" class="headerlink" title="24. 查询分组关联属性和删除关联"></a>24. 查询分组关联属性和删除关联</h2><p>获取属性分组的关联的所有属性<br>API：<a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/LnjzZHPj" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/LnjzZHPj</a><br>发送请求：/product/attrgroup/{attrgroupId}/attr/relation<br>获取当前属性分组所关联的属性<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341339380-3f67ba40-279f-4b71-8759-620f669af00e.png#align=left&amp;display=inline&amp;height=529&amp;margin=%5Bobject%20Object%5D&amp;originHeight=529&amp;originWidth=1838&amp;status=done&amp;style=none&amp;width=1838" alt><br>如何查找：既然给出了attr_group_id，那么到中间表中查询出来所关联的attr_id，然后得到最终的所有属性即可。<br>可能出现null值的问题</p>
<h2 id="25-查询分组未关联的属性"><a href="#25-查询分组未关联的属性" class="headerlink" title="25. 查询分组未关联的属性"></a>25. 查询分组未关联的属性</h2><p>/product/attrgroup/{attrgroupId}/noattr/relation<br>API：<a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/d3EezLdO" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/d3EezLdO</a><br>获取属性分组里面还没有关联的本分类里面的其他基本属性，方便添加新的关联<br>Request URL: <a href="http://localhost:88/api/product/attrgroup/1/noattr/relation?t=1588780783441&amp;page=1&amp;limit=10&amp;key=" target="_blank" rel="noopener">http://localhost:88/api/product/attrgroup/1/noattr/relation?t=1588780783441&amp;page=1&amp;limit=10&amp;key=</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341339455-aab58f73-7472-48da-bba5-51ddcf5cc9c3.png#align=left&amp;display=inline&amp;height=606&amp;margin=%5Bobject%20Object%5D&amp;originHeight=606&amp;originWidth=1454&amp;status=done&amp;style=none&amp;width=1454" alt><br>属性分组，对应于“pms_attr_group”表，每个分组下，需要查看到关联了哪些属性信息，销售属性不需要和分组进行关联，但是规格参数要和属性分组进行关联。<br>规格参数：对应于<code>pms_attr</code>表，attr_type=1，需要显示分组信息<br>销售属性：对应于pms_attr`表，attr_type=0，不需要显示分组信息<br>分组ID为9的分组：Request URL: <a href="http://localhost:88/api/product/attrgroup/9/noattr/relation?t=1588822258669&amp;page=1&amp;limit=10&amp;key=" target="_blank" rel="noopener">http://localhost:88/api/product/attrgroup/9/noattr/relation?t=1588822258669&amp;page=1&amp;limit=10&amp;key=</a><br>对应的数据库字段<br>attr_group_id  attr_group_name    sort  descript                icon    catelog_id</p>
<hr>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">9</span>  主体                    <span class="number">1</span>  型号 平台                   wu               <span class="number">454</span></span><br><span class="line">       <span class="number">10</span>  显卡                    <span class="number">1</span>  显存容量                    wu               <span class="number">454</span></span><br><span class="line">       <span class="number">11</span>  输入设备                  <span class="number">1</span>  鼠标 键盘                   wu               <span class="number">454</span></span><br><span class="line">       <span class="number">12</span>  主板                    <span class="number">1</span>  显卡类型 芯片组                wu               <span class="number">454</span></span><br><span class="line">       <span class="number">13</span>  规格                    <span class="number">1</span>  尺寸                      wu               <span class="number">454</span></span><br></pre></td></tr></table></figure>
<p>查询attrgroupId=9的属性分组：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AttrGroupEntity attrGroupEntity = attrGroupDao.selectById(attrgroupId);</span><br></pre></td></tr></table></figure></p>
<p>获取到分类信息：<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Long catelogId = attrGroupEntity.getCatelogId()<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>目标：获取属性分组没有关联的其他属性<br>也就是获取attrgroupId=9的属性分组中，关联的分类catelog_id =454 （台式机），其他基本属性<br>在该属性分组中，现在已经关联的属性：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341339750-28c2e511-40f5-4fe0-92c6-111e7958d8fd.png#align=left&amp;display=inline&amp;height=271&amp;margin=%5Bobject%20Object%5D&amp;originHeight=271&amp;originWidth=907&amp;status=done&amp;style=none&amp;width=907" alt><br>本分类下，存在哪些基本属性？<br>没有关联的其他属性<br>已经关联的属性，这些属性是如何关联上的？<br>答：在创建规格参数的时候，已经设置了需要关联哪些属性分组。<br>想要知道还没有关联哪些，先查看关联了哪些，如何排除掉这些就是未关联的<br>在中间表中显示了属性和属性分组之间的关联关系，在属性表中显示了所有的属性，<br>先查询中间表，得到所有已经关联的属性的id，然后再次查询属性表，排除掉已经建立关联的属性ID，将剩下的属性ID和属性建立起关联关系</p>
<h2 id="26-添加属性和分组的关联关系"><a href="#26-添加属性和分组的关联关系" class="headerlink" title="26. 添加属性和分组的关联关系"></a>26. 添加属性和分组的关联关系</h2><p>请求类型：Request URL: <a href="http://localhost:88/api/product/attrgroup/attr/relation" target="_blank" rel="noopener">http://localhost:88/api/product/attrgroup/attr/relation</a><br>请求方式：POST<br>请求数据：[{“attrId”:10,”attrGroupId”:9}]<br>API：<a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/VhgnaedC" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/VhgnaedC</a><br>响应数据：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"msg"</span>: <span class="string">"success"</span>,</span><br><span class="line">	<span class="attr">"code"</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>本质就是在中间表pms_attr_attrgroup_relation中，添加一条记录的过程</p>
<h2 id="27-发布商品"><a href="#27-发布商品" class="headerlink" title="27. 发布商品"></a>27. 发布商品</h2><p>获取所有会员等级：/member/memberlevel/list<br>API：<a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf</a><br>在“gulimall-gateway”中修改“”文件，添加对于member的路由<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">gulimall-member</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://gulimall-member</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/member/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>在“gulimall-member”中，创建“bootstrap.properties”文件，内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.config.name=gulimall-member</span><br><span class="line">spring.cloud.nacos.config.server-addr=192.168.137.14:8848</span><br><span class="line">spring.cloud.nacos.config.namespace=795521fa-77ef-411e-a8d8-0889fdfe6964</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].data-id=gulimall-member.yml</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].group=DEFAULT_GROUP</span><br><span class="line">spring.cloud.nacos.config.extension-configs[0].refresh=true</span><br></pre></td></tr></table></figure></p>
<p>获取分类关联的品牌：/product/categorybrandrelation/brands/list<br>API：<a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/HgVjlzWV" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/HgVjlzWV</a><br>遇到PubSub问题</p>
<ol>
<li><p>首先安装pubsub-js</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`npm <span class="keyword">install</span> <span class="comment">--save pubsub-js`</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>订阅方组件</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`<span class="keyword">import</span> PubSub <span class="keyword">from</span> <span class="string">'pubsub-js'</span>`</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>该this.PubSub为PubSub。<br>获取分类下所有分组&amp;关联属性<br>请求类型：/product/attrgroup/{catelogId}/withattr<br>请求方式：GET<br>请求URL：<a href="http://localhost:88/api/product/attrgroup/225/withattr?t=1588864569478" target="_blank" rel="noopener">http://localhost:88/api/product/attrgroup/225/withattr?t=1588864569478</a><br>mysql默认的隔离级别为读已提交，为了能够在调试过程中，获取到数据库中的数据信息，可以调整隔离级别为读未提交：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">SESSION</span> <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> <span class="keyword">READ</span> UNCOMMITTED;</span><br></pre></td></tr></table></figure></p>
<p>但是它对于当前的事务窗口生效，如果想要设置全局的，需要加上global字段。</p>
<h2 id="28-商品管理"><a href="#28-商品管理" class="headerlink" title="28. 商品管理"></a>28. 商品管理</h2><p>当新建时：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">t:</span> <span class="number">1588983621569</span></span><br><span class="line"><span class="attr">status:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">key:</span> </span><br><span class="line"><span class="attr">brandId:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">catelogId:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">page:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">limit:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure></p>
<p>当上架时：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">t:</span> <span class="number">1588983754030</span></span><br><span class="line"><span class="attr">status:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">key:</span> </span><br><span class="line"><span class="attr">brandId:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">catelogId:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">page:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">limit:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure></p>
<p>当下架时：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">t:</span> <span class="number">1588983789089</span></span><br><span class="line"><span class="attr">status:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">key:</span> </span><br><span class="line"><span class="attr">brandId:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">catelogId:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">page:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">limit:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure></p>
<p>在SPU中，写出的日期数据都不符合规则：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341339816-267819e0-13fb-4b8b-8327-ad0d03b91fe4.png#align=left&amp;display=inline&amp;height=197&amp;margin=%5Bobject%20Object%5D&amp;originHeight=197&amp;originWidth=1427&amp;status=done&amp;style=none&amp;width=1427" alt><br>想要符合规则，可以设置写出数据的规则：<br>spring.jackson<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure></p>
<p>SKU检索：<br>Request URL: <a href="http://localhost:88/api/product/skuinfo/list?t=1588989437944&amp;page=1&amp;limit=10&amp;key=&amp;catelogId=0&amp;brandId=0&amp;min=0&amp;max=0" target="_blank" rel="noopener">http://localhost:88/api/product/skuinfo/list?t=1588989437944&amp;page=1&amp;limit=10&amp;key=&amp;catelogId=0&amp;brandId=0&amp;min=0&amp;max=0</a><br>请求体：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">t:</span> <span class="number">1588989437944</span></span><br><span class="line"><span class="attr">page:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">limit:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">key:</span> </span><br><span class="line"><span class="attr">catelogId:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">brandId:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">min:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">max:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>API： <a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/ucirLq1D" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/ucirLq1D</a></p>
<h2 id="29-仓库管理"><a href="#29-仓库管理" class="headerlink" title="29. 仓库管理"></a>29. 仓库管理</h2><p>库存信息表：wms_ware_info<br>【1】仓库列表功能：<br>【2】查询商品库存：<br>【3】查询采购需求：<br>【4】 合并采购需求：<br>合并整单选中parcharseID：Request URL: <a href="http://localhost:88/api/ware/purchase/merge" target="_blank" rel="noopener">http://localhost:88/api/ware/purchase/merge</a><br>请求数据：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;purchaseId: 1, items: [1, 2]&#125;</span><br><span class="line">items: [1, 2]</span><br></pre></td></tr></table></figure></p>
<p>合并整单未选择parcharseID :Request URL: <a href="http://localhost:88/api/ware/purchase/merge" target="_blank" rel="noopener">http://localhost:88/api/ware/purchase/merge</a><br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341339865-0aedccb1-7a72-4c39-b5fd-81deb14bb2d9.png#align=left&amp;display=inline&amp;height=208&amp;margin=%5Bobject%20Object%5D&amp;originHeight=208&amp;originWidth=573&amp;status=done&amp;style=none&amp;width=573" alt><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">items:</span> <span class="string">[1,</span> <span class="number">2</span><span class="string">]</span></span><br></pre></td></tr></table></figure></p>
<p>涉及到两张表：wms_purchase_detail，wms_purchase<br>现在采购单中填写数据，然后关联用户，关联用户后，<br>总的含义，就是根据采购单中的信息，更新采购需求，在采购单中填写采购人员，采购单号，采购的时候，更新采购细节表中的采购人员ID和采购状态。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341340029-9fd47e89-d301-4d29-b5f2-1cea54f01e5d.png#align=left&amp;display=inline&amp;height=540&amp;margin=%5Bobject%20Object%5D&amp;originHeight=540&amp;originWidth=1037&amp;status=done&amp;style=none&amp;width=1037" alt><br>领取采购单<br><a href="http://localhost:88/api/ware/purchase/received" target="_blank" rel="noopener">http://localhost:88/api/ware/purchase/received</a><br>（1）某个人领取了采购单后，先看采购单是否处于未分配状态，只有采购单是新建或以领取状态时，才更新采购单的状态<br>（2）<br>【1】仓库列表功能： <a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/mZgdqOWe" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/mZgdqOWe</a><br>【2】查询商品库存： <a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/hwXrEXBZ" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/hwXrEXBZ</a><br>【3】查询采购需求： <a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/Ss4zsV7R" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/Ss4zsV7R</a><br>【4】 合并采购需求：<a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/cUlv9QvK" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/cUlv9QvK</a><br>【5】查询未领取的采购单： <a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/hI12DNrH" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/hI12DNrH</a><br>【6】领取采购单： <a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/vXMBBgw1" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/vXMBBgw1</a><br>完成采购，在完成采购过程中，需要涉及到设置SKU的name信息到仓库中，这是通过远程调用“gulimall-product”来实现根据sku_id查询得到sku_name的，如果这个过程发生了异常，事务不想要回滚，目前采用的方式是通过捕获异常的方式，防止事务回滚，是否还有其他的方式呢？这个问题留待以后解决。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addStock</span><span class="params">(Long skuId, Long wareId, Integer skuNum)</span> </span>&#123;</span><br><span class="line">        List&lt;WareSkuEntity&gt; wareSkuEntities = wareSkuDao.selectList(<span class="keyword">new</span> QueryWrapper&lt;WareSkuEntity&gt;().eq(<span class="string">"sku_id"</span>, skuId).eq(<span class="string">"ware_id"</span>, wareId));</span><br><span class="line">        <span class="keyword">if</span>(wareSkuEntities == <span class="keyword">null</span> || wareSkuEntities.size() ==<span class="number">0</span> )&#123;</span><br><span class="line">             <span class="comment">//新增</span></span><br><span class="line">            WareSkuEntity wareSkuEntity = <span class="keyword">new</span> WareSkuEntity();</span><br><span class="line">            wareSkuEntity.setSkuId(skuId);</span><br><span class="line">            wareSkuEntity.setWareId(wareId);</span><br><span class="line">            wareSkuEntity.setStock(skuNum);</span><br><span class="line">            wareSkuEntity.setStockLocked(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">//远程查询SKU的name，若失败无需回滚</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                R info = productFeignService.info(skuId);</span><br><span class="line">                <span class="keyword">if</span>(info.getCode() == <span class="number">0</span>)&#123;</span><br><span class="line">                    Map&lt;String,Object&gt; data=(Map&lt;String,Object&gt;)info.get(<span class="string">"skuInfo"</span>);</span><br><span class="line">                    wareSkuEntity.setSkuName((String) data.get(<span class="string">"skuName"</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            wareSkuDao.insert(wareSkuEntity);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//插入</span></span><br><span class="line">            wareSkuDao.addStock(skuId,wareId,skuNum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="30-获取spu规格"><a href="#30-获取spu规格" class="headerlink" title="30. 获取spu规格"></a>30. 获取spu规格</h2><p>在SPU管理页面，获取商品规格的时候，出现400异常，浏览器显示跳转不了<br>问题现象：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341340071-6947b9c5-a965-4e11-a07e-4e1655ba8619.png#align=left&amp;display=inline&amp;height=630&amp;margin=%5Bobject%20Object%5D&amp;originHeight=630&amp;originWidth=988&amp;status=done&amp;style=none&amp;width=988" alt><br>出现问题的代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">attrUpdateShow(row) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(row);</span><br><span class="line">      <span class="keyword">this</span>.$router.push(&#123;</span><br><span class="line">        path: <span class="string">"/product-attrupdate"</span>,</span><br><span class="line">        query: &#123; <span class="attr">spuId</span>: row.id, <span class="attr">catalogId</span>: row.catalogId &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></p>
<p>暂时不知道如何解决问题。只能留待以后解决。<br>经过测试发现，问题和上面的代码没有关系，问题出现在“attrupdate.vue”上，该vue页面无法通过浏览器访问，当输入访问URL（ <a href="http://localhost:8001/#/product-attrupdate" target="_blank" rel="noopener">http://localhost:8001/#/product-attrupdate</a> ）的时候，就会出现404，而其他的请求则不会出现这种情况，不知为何。<br>通过POSTMAN进行请求的时候，能够请求到数据。<br>经过分析发现，是因为在数据库中没有该页面的导航所导致的，为了修正这个问题，可以在“sys-menu”表中添加一行，内容位：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341340191-43c67b17-bfef-4907-827c-b394c0337892.png#align=left&amp;display=inline&amp;height=126&amp;margin=%5Bobject%20Object%5D&amp;originHeight=126&amp;originWidth=1121&amp;status=done&amp;style=none&amp;width=1121" alt><br>这样当再次访问的时候，在“平台属性”下，会出现“规格维护”菜单，<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341340477-46d57126-5536-43c7-b185-2f51b1e52f86.png#align=left&amp;display=inline&amp;height=349&amp;margin=%5Bobject%20Object%5D&amp;originHeight=349&amp;originWidth=366&amp;status=done&amp;style=none&amp;width=366" alt><br>当再次点击“规格”的时候，显示出菜单<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341340555-6e9f30b1-859d-4ec1-9d85-67bf9cbe415c.png#align=left&amp;display=inline&amp;height=647&amp;margin=%5Bobject%20Object%5D&amp;originHeight=647&amp;originWidth=1476&amp;status=done&amp;style=none&amp;width=1476" alt><br>不过这种菜单并不符合我们的需要，我们需要让它以弹出框的形式出现。</p>
<h2 id="31-修改商品规格"><a href="#31-修改商品规格" class="headerlink" title="31. 修改商品规格"></a>31. 修改商品规格</h2><p>API： <a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/GhnJ0L85" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/GhnJ0L85</a><br>URL：/product/attr/update/{spuId}</p>
<h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><h3 id="1-在open-fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。"><a href="#1-在open-fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。" class="headerlink" title="1.  在open fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。"></a>1.  在open fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。</h3><p>调用方：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(value = <span class="string">"gulimall-coupon"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CouponFenService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/coupon/spubounds/save"</span>)</span><br><span class="line">    <span class="function">R <span class="title">saveSpuBounds</span><span class="params">(@RequestBody SpuBoundTo spuBoundTo)</span></span>;</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/coupon/skufullreduction/saveInfo"</span>)</span><br><span class="line">    <span class="function">R <span class="title">saveSkuReduction</span><span class="params">(@RequestBody SkuReductionTo skuReductionTo)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>被调用方：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/save"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(@RequestBody SpuBoundsEntity spuBounds)</span></span>&#123;</span><br><span class="line">		spuBoundsService.save(spuBounds);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/saveInfo"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">saveInfo</span><span class="params">(@RequestBody SkuReductionTo skuReductionTo)</span></span>&#123;</span><br><span class="line">        skuFullReductionService.saveSkuReduction(skuReductionTo);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>调用方JSON化时的对象SpuBoundTo：<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuBoundTo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> spuId;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal buyBounds;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal growBounds;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>被调用方JSON数据对象化时的对象SpuBoundsEntity：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 商品spu积分设置</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> cosmoswong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> cosmoswong@sina.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-04-23 23:38:48</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName</span>(<span class="string">"sms_spu_bounds"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpuBoundsEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * id</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@TableId</span></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Long spuId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 成长积分</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> BigDecimal growBounds;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 购物积分</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> BigDecimal buyBounds;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 优惠生效情况[1111（四个状态位，从右到左）;0 - 无优惠，成长积分是否赠送;1 - 无优惠，购物积分是否赠送;2 - 有优惠，成长积分是否赠送;3 - 有优惠，购物积分是否赠送【状态位0：不赠送，1：赠送】]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Integer work;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="2-事务究竟要如何加上？"><a href="#2-事务究竟要如何加上？" class="headerlink" title="2. 事务究竟要如何加上？"></a>2. 事务究竟要如何加上？</h3><p>存在Batch操作的时候，才需要加上事务，单个操作无需添加事务控制。<br>SpringBoot中的是事务<br>批量操作的时候，才需要事务<br>一个事务标注的方法上，方法内存在这些操作：<br>（1）批量更新一个表中字段<br>（2）更新多张表中的操作<br>实际上不论是哪种类型，方法中所有对于数据库的写操作，都会被整体当做一个事务，在这个事务过程中，如果某个操作出现了异常，则整体都不会被提交。这就是对于SpringBoot中的@Transactional的理解。<br>@EnableTransactionManagement和@Transactional的区别？<br><a href="https://blog.csdn.net/abysscarry/article/details/80189232" target="_blank" rel="noopener">https://blog.csdn.net/abysscarry/article/details/80189232</a><br><a href="https://blog.csdn.net/Driver_tu/article/details/99679145" target="_blank" rel="noopener">https://blog.csdn.net/Driver_tu/article/details/99679145</a><br><a href="https:_www.cnblogs.com_leaveast_p_11765503" target="_blank" rel="noopener">https://www.cnblogs.com/leaveast/p/11765503.html</a></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="1-文档参考地址"><a href="#1-文档参考地址" class="headerlink" title="1. 文档参考地址"></a>1. 文档参考地址</h3><p><a href="http://www.jayh.club/#/02.PassJava%E6%9E%B6%E6%9E%84%E7%AF%87/01.%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9D%97" target="_blank" rel="noopener">http://www.jayh.club/#/02.PassJava%E6%9E%B6%E6%9E%84%E7%AF%87/01.%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9D%97</a><br><a href="https://blog.csdn.net/ok_wolf/article/details/105400748" target="_blank" rel="noopener">https://blog.csdn.net/ok_wolf/article/details/105400748</a><br><a href="https:_www.cnblogs.com_javalbb_p_12690862" target="_blank" rel="noopener">https://www.cnblogs.com/javalbb/p/12690862.html</a><br><a href="https://blog.csdn.net/ok_wolf/article/details/105456170" target="_blank" rel="noopener">https://blog.csdn.net/ok_wolf/article/details/105456170</a><br><a href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf" target="_blank" rel="noopener">https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf</a></p>
<h3 id="2-开机启动docker"><a href="#2-开机启动docker" class="headerlink" title="2. 开机启动docker"></a>2. 开机启动docker</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341340699-aa9ded04-1c4a-4d0a-8e8b-ceec0369f5b9.png#align=left&amp;display=inline&amp;height=197&amp;margin=%5Bobject%20Object%5D&amp;originHeight=197&amp;originWidth=1257&amp;status=done&amp;style=none&amp;width=1257" alt><br>在Docker中设置开机启动容器<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341340850-e36a4020-c6c8-4d1c-a3d6-80e3ce770029.png#align=left&amp;display=inline&amp;height=100&amp;margin=%5Bobject%20Object%5D&amp;originHeight=100&amp;originWidth=784&amp;status=done&amp;style=none&amp;width=784" alt><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看防火墙状态</span></span><br><span class="line">[root@hadoop-104 module]# systemctl status firewalld</span><br><span class="line">  firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Wed 2020-04-22 21:26:23 EDT; 10min ago</span><br><span class="line">     Docs: man:firewalld(1)</span><br><span class="line"> Main PID: 5947 (firewalld)</span><br><span class="line">   CGroup: /system.slice/firewalld.service</span><br><span class="line">           └─5947 /usr/bin/python -Es /usr/sbin/firewalld --nofork --nopid</span><br><span class="line">Apr 22 21:26:20 hadoop-104 systemd[1]: Starting firewalld - dynamic firewall daemon...</span><br><span class="line">Apr 22 21:26:23 hadoop-104 systemd[1]: Started firewalld - dynamic firewall daemon.</span><br><span class="line"><span class="meta">#</span><span class="bash">查看防火墙是否是开机启动</span></span><br><span class="line">[root@hadoop-104 module]# systemctl list-unit-files|grep firewalld</span><br><span class="line">firewalld.service                             enabled </span><br><span class="line"><span class="meta">#</span><span class="bash">关闭开机启动防火墙</span></span><br><span class="line">[root@hadoop-104 module]# systemctl disable firewalld             </span><br><span class="line">Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span><br><span class="line"><span class="meta">#</span><span class="bash">停止防火墙</span></span><br><span class="line">[root@hadoop-104 module]# systemctl stop firewalld         </span><br><span class="line"><span class="meta">#</span><span class="bash">再次查看防火墙</span></span><br><span class="line">[root@hadoop-104 module]# systemctl list-unit-files|grep firewalld</span><br><span class="line">firewalld.service                             disabled</span><br><span class="line">[root@hadoop-104 module]#</span><br></pre></td></tr></table></figure></p>
<h3 id="3-查看命令的安装位置"><a href="#3-查看命令的安装位置" class="headerlink" title="3. 查看命令的安装位置"></a>3. 查看命令的安装位置</h3><p>whereis mysql：查看mysql的安装位置</p>
<h3 id="4-vscode中生成代码片段"><a href="#4-vscode中生成代码片段" class="headerlink" title="4. vscode中生成代码片段"></a>4. vscode中生成代码片段</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341340989-e6b6b684-37fa-4697-8c3c-6c2a04c01670.png#align=left&amp;display=inline&amp;height=778&amp;margin=%5Bobject%20Object%5D&amp;originHeight=778&amp;originWidth=1008&amp;status=done&amp;style=none&amp;width=1008" alt><br>新建一个全局的代码片段，名字为vue，然后回车：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341341168-9be0a6a7-73b9-440b-afab-dad7c7b90412.png#align=left&amp;display=inline&amp;height=269&amp;margin=%5Bobject%20Object%5D&amp;originHeight=269&amp;originWidth=934&amp;status=done&amp;style=none&amp;width=934" alt><br>将下面的代码片段粘贴到“vue.code-snippets”<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Place your 全局 snippets here. Each snippet is defined under a snippet name and has a scope, prefix, body and </span></span><br><span class="line">    <span class="comment">// description. Add comma separated ids of the languages where the snippet is applicable in the scope field. If scope </span></span><br><span class="line">    <span class="comment">// is left empty or omitted, the snippet gets applied to all languages. The prefix is what is </span></span><br><span class="line">    <span class="comment">// used to trigger the snippet and the body will be expanded and inserted. Possible variables are: </span></span><br><span class="line">    <span class="comment">// $1, $2 for tab stops, $0 for the final cursor position, and $&#123;1:label&#125;, $&#123;2:another&#125; for placeholders. </span></span><br><span class="line">    <span class="comment">// Placeholders with the same ids are connected.</span></span><br><span class="line">    <span class="comment">// Example:</span></span><br><span class="line">    <span class="comment">// "Print to console": &#123;</span></span><br><span class="line">    <span class="comment">// 	"scope": "javascript,typescript",</span></span><br><span class="line">    <span class="comment">// 	"prefix": "log",</span></span><br><span class="line">    <span class="comment">// 	"body": [</span></span><br><span class="line">    <span class="comment">// 		"console.log('$1');",</span></span><br><span class="line">    <span class="comment">// 		"$2"</span></span><br><span class="line">    <span class="comment">// 	],</span></span><br><span class="line">    <span class="comment">// 	"description": "Log output to console"</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="attr">"生成vue模板"</span>: &#123;</span><br><span class="line">        <span class="attr">"prefix"</span>: <span class="string">"vue"</span>,</span><br><span class="line">        <span class="attr">"body"</span>: [</span><br><span class="line">            <span class="string">"&lt;!-- $1 --&gt;"</span>,</span><br><span class="line">            <span class="string">"&lt;template&gt;"</span>,</span><br><span class="line">            <span class="string">"&lt;div class='$2'&gt;$5&lt;/div&gt;"</span>,</span><br><span class="line">            <span class="string">"&lt;/template&gt;"</span>,</span><br><span class="line">            <span class="string">""</span>,</span><br><span class="line">            <span class="string">"&lt;script&gt;"</span>,</span><br><span class="line">            <span class="string">"//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）"</span>,</span><br><span class="line">            <span class="string">"//例如：import 《组件名称》 from '《组件路径》';"</span>,</span><br><span class="line">            <span class="string">""</span>,</span><br><span class="line">            <span class="string">"export default &#123;"</span>,</span><br><span class="line">            <span class="string">"//import引入的组件需要注入到对象中才能使用"</span>,</span><br><span class="line">            <span class="string">"components: &#123;&#125;,"</span>,</span><br><span class="line">            <span class="string">"data() &#123;"</span>,</span><br><span class="line">            <span class="string">"//这里存放数据"</span>,</span><br><span class="line">            <span class="string">"return &#123;"</span>,</span><br><span class="line">            <span class="string">""</span>,</span><br><span class="line">            <span class="string">"&#125;;"</span>,</span><br><span class="line">            <span class="string">"&#125;,"</span>,</span><br><span class="line">            <span class="string">"//监听属性 类似于data概念"</span>,</span><br><span class="line">            <span class="string">"computed: &#123;&#125;,"</span>,</span><br><span class="line">            <span class="string">"//监控data中的数据变化"</span>,</span><br><span class="line">            <span class="string">"watch: &#123;&#125;,"</span>,</span><br><span class="line">            <span class="string">"//方法集合"</span>,</span><br><span class="line">            <span class="string">"methods: &#123;"</span>,</span><br><span class="line">            <span class="string">""</span>,</span><br><span class="line">            <span class="string">"&#125;,"</span>,</span><br><span class="line">            <span class="string">"//生命周期 - 创建完成（可以访问当前this实例）"</span>,</span><br><span class="line">            <span class="string">"created() &#123;"</span>,</span><br><span class="line">            <span class="string">""</span>,</span><br><span class="line">            <span class="string">"&#125;,"</span>,</span><br><span class="line">            <span class="string">"//生命周期 - 挂载完成（可以访问DOM元素）"</span>,</span><br><span class="line">            <span class="string">"mounted() &#123;"</span>,</span><br><span class="line">            <span class="string">""</span>,</span><br><span class="line">            <span class="string">"&#125;,"</span>,</span><br><span class="line">            <span class="string">"beforeCreate() &#123;&#125;, //生命周期 - 创建之前"</span>,</span><br><span class="line">            <span class="string">"beforeMount() &#123;&#125;, //生命周期 - 挂载之前"</span>,</span><br><span class="line">            <span class="string">"beforeUpdate() &#123;&#125;, //生命周期 - 更新之前"</span>,</span><br><span class="line">            <span class="string">"updated() &#123;&#125;, //生命周期 - 更新之后"</span>,</span><br><span class="line">            <span class="string">"beforeDestroy() &#123;&#125;, //生命周期 - 销毁之前"</span>,</span><br><span class="line">            <span class="string">"destroyed() &#123;&#125;, //生命周期 - 销毁完成"</span>,</span><br><span class="line">            <span class="string">"activated() &#123;&#125;, //如果页面有keep-alive缓存功能，这个函数会触发"</span>,</span><br><span class="line">            <span class="string">"&#125;"</span>,</span><br><span class="line">            <span class="string">"&lt;/script&gt;"</span>,</span><br><span class="line">            <span class="string">"&lt;style lang='scss' scoped&gt;"</span>,</span><br><span class="line">            <span class="string">"//@import url($3); 引入公共css类"</span>,</span><br><span class="line">            <span class="string">"$4"</span>,</span><br><span class="line">            <span class="string">"&lt;/style&gt;"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"description"</span>: <span class="string">"生成VUE模板"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"http-get请求"</span>: &#123;</span><br><span class="line">        <span class="attr">"prefix"</span>: <span class="string">"httpget"</span>,</span><br><span class="line">        <span class="attr">"body"</span>: [</span><br><span class="line">            <span class="string">"this.\\$http(&#123;"</span>,</span><br><span class="line">            <span class="string">"url: this.\\$http.adornUrl(''),"</span>,</span><br><span class="line">            <span class="string">"method: 'get',"</span>,</span><br><span class="line">            <span class="string">"params: this.\\$http.adornParams(&#123;&#125;)"</span>,</span><br><span class="line">            <span class="string">"&#125;).then((&#123; data &#125;) =&gt; &#123;"</span>,</span><br><span class="line">            <span class="string">"&#125;)"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"description"</span>: <span class="string">"httpGET请求"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"http-post请求"</span>: &#123;</span><br><span class="line">        <span class="attr">"prefix"</span>: <span class="string">"httppost"</span>,</span><br><span class="line">        <span class="attr">"body"</span>: [</span><br><span class="line">            <span class="string">"this.\\$http(&#123;"</span>,</span><br><span class="line">            <span class="string">"url: this.\\$http.adornUrl(''),"</span>,</span><br><span class="line">            <span class="string">"method: 'post',"</span>,</span><br><span class="line">            <span class="string">"data: this.\\$http.adornData(data, false)"</span>,</span><br><span class="line">            <span class="string">"&#125;).then((&#123; data &#125;) =&gt; &#123; &#125;);"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"description"</span>: <span class="string">"httpPOST请求"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>更多详细说明见： <a href="https://blog.csdn.net/z772330927/article/details/105730430/" target="_blank" rel="noopener">https://blog.csdn.net/z772330927/article/details/105730430/</a></p>
<h3 id="5-vscode快捷键"><a href="#5-vscode快捷键" class="headerlink" title="5. vscode快捷键"></a>5. vscode快捷键</h3><p>ctrl+shift+f 全局搜索<br>alt+shift+f 格式化代码</p>
<h3 id="6-关闭eslint的语法检查"><a href="#6-关闭eslint的语法检查" class="headerlink" title="6.  关闭eslint的语法检查"></a>6.  关闭eslint的语法检查</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341341264-5dee9329-3da8-4a6d-8199-13ab77467ebf.png#align=left&amp;display=inline&amp;height=314&amp;margin=%5Bobject%20Object%5D&amp;originHeight=314&amp;originWidth=1196&amp;status=done&amp;style=none&amp;width=1196" alt></p>
<h3 id="7-安装mybatisx插件"><a href="#7-安装mybatisx插件" class="headerlink" title="7. 安装mybatisx插件"></a>7. 安装mybatisx插件</h3><p>在Marketplace中搜索“mybatisx”，安装后重启IDEA，使用时会自动在@Mapper标注的接口上，产生小图标，然后alt+enter，generate statement，就会自动的在xml文件中生成SQL。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341341317-ab33caa4-af3a-4229-ac08-e52df91ef55e.png#align=left&amp;display=inline&amp;height=266&amp;margin=%5Bobject%20Object%5D&amp;originHeight=266&amp;originWidth=743&amp;status=done&amp;style=none&amp;width=743" alt></p>
<h3 id="8-mysql的批量删除"><a href="#8-mysql的批量删除" class="headerlink" title="8. mysql的批量删除"></a>8. mysql的批量删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span>  <span class="string">`pms_attr_attrgroup_relation`</span> <span class="keyword">WHERE</span> (attr_id= ? <span class="keyword">AND</span> attr_group_id ) <span class="keyword">OR</span> (attr_id= ? <span class="keyword">AND</span> attr_group_id )</span><br></pre></td></tr></table></figure>
<h3 id="9-String-join"><a href="#9-String-join" class="headerlink" title="9. String.join"></a>9. String.join</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.lang.String <span class="meta">@NotNull</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">join</span><span class="params">(@NotNull CharSequence delimiter,</span></span></span><br><span class="line"><span class="function"><span class="params">                          @NotNull Iterable&lt;? extends CharSequence&gt; elements)</span></span></span><br></pre></td></tr></table></figure>
<p>Returns a new String composed of copies of the CharSequence elements joined together with a copy of the specified delimiter.<br>返回一个由CharSequence元素的副本和指定分隔符的副本组成的新字符串。<br>For example,<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;<span class="keyword">String</span>&gt; strings = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"> strings.<span class="built_in">add</span>(<span class="string">"Java"</span>);strings.<span class="built_in">add</span>(<span class="string">"is"</span>);</span><br><span class="line"> strings.<span class="built_in">add</span>(<span class="string">"cool"</span>);</span><br><span class="line"> <span class="keyword">String</span> message = <span class="keyword">String</span>.<span class="built_in">join</span>(<span class="string">" "</span>, strings);</span><br><span class="line"> <span class="comment">//message returned is: "Java is cool"</span></span><br><span class="line"> Set&lt;<span class="keyword">String</span>&gt; strings = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br><span class="line"> strings.<span class="built_in">add</span>(<span class="string">"Java"</span>); strings.<span class="built_in">add</span>(<span class="string">"is"</span>);</span><br><span class="line"> strings.<span class="built_in">add</span>(<span class="string">"very"</span>); strings.<span class="built_in">add</span>(<span class="string">"cool"</span>);</span><br><span class="line"> <span class="keyword">String</span> message = <span class="keyword">String</span>.<span class="built_in">join</span>(<span class="string">"-"</span>, strings);</span><br><span class="line"> <span class="comment">//message returned is: "Java-is-very-cool"</span></span><br></pre></td></tr></table></figure></p>
<p>Note that if an individual element is null, then “null” is added.<br>注意，如果单个元素为null，则添加“null”。<br>Params:<br>delimiter – a sequence of characters that is used to separate each of the elements in the resulting String<br>用于分隔结果字符串中的每个元素的字符序列<br>elements – an Iterable that will have its elements joined together.<br>将其元素连接在一起的可迭代的。<br>Returns:<br>a new String that is composed from the elements argument<br>由elements参数组成的新字符串<br>Throws:<br>NullPointerException – If delimiter or elements is null<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">join</span><span class="params">(CharSequence delimiter,</span></span></span><br><span class="line"><span class="function"><span class="params">            Iterable&lt;? extends CharSequence&gt; elements)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(delimiter);</span><br><span class="line">        Objects.requireNonNull(elements);</span><br><span class="line">        StringJoiner joiner = <span class="keyword">new</span> StringJoiner(delimiter);</span><br><span class="line">        <span class="keyword">for</span> (CharSequence cs: elements) &#123;</span><br><span class="line">            joiner.add(cs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> joiner.toString();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>能够看到实际上它就是通过创建StringJoiner，然后遍历elements，加入每个元素来完成的。<br>StringJoiner<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java.util <span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringJoiner</span></span></span><br><span class="line"><span class="class"><span class="keyword">extends</span> <span class="title">Object</span></span></span><br></pre></td></tr></table></figure></p>
<p>StringJoiner is used to construct a sequence of characters separated by a delimiter and optionally starting with a supplied prefix and ending with a supplied suffix.<br>tringJoiner用于构造由分隔符分隔的字符序列，可以选择以提供的前缀开始，以提供的后缀结束。<br>Prior to adding something to the StringJoiner, its sj.toString() method will, by default, return prefix + suffix. However, if the setEmptyValue method is called, the emptyValue supplied will be returned instead. This can be used, for example, when creating a string using set notation to indicate an empty set, i.e. “{}”, where the prefix is “{“, the suffix is “}” and nothing has been added to the StringJoiner.<br>在向StringJoiner添加内容之前，它的sj.toString()方法在默认情况下会返回前缀+后缀。但是，如果调用setEmptyValue方法，则返回所提供的emptyValue。例如，当使用set符号创建一个字符串来表示一个空集时，可以使用这种方法。“{}”，其中前缀是“{”，后缀是“}”，没有向StringJoiner添加任何内容。<br>apiNote:<br>The String “[George:Sally:Fred]” may be constructed as follows:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StringJoiner sj = <span class="keyword">new</span> StringJoiner(<span class="string">":"</span>, <span class="string">"["</span>, <span class="string">"]"</span>);</span><br><span class="line"> sj.add(<span class="string">"George"</span>).add(<span class="string">"Sally"</span>).add(<span class="string">"Fred"</span>);</span><br><span class="line"> String desiredString = sj.toString();</span><br></pre></td></tr></table></figure></p>
<p>A StringJoiner may be employed to create formatted output from a java.util.stream.Stream using java.util.stream.Collectors.joining(CharSequence). For example:<br>使用StringJoiner从java.util.stream创建格式化输出流，使用java.util.stream.Collectors.joining (CharSequence进行)。例如:<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">Integer</span>&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"> <span class="built_in">String</span> commaSeparatedNumbers = numbers.stream()</span><br><span class="line">     .<span class="built_in">map</span>(i -&gt; i.toString())</span><br><span class="line">     .collect(Collectors.joining(<span class="string">", "</span>));</span><br></pre></td></tr></table></figure></p>
<p>通过分析源码发现，在“”内部维护了一个StringBuilder，所有加入到它内部的元素都会先拼接上分割符，然后再拼接上加入的元素<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> StringJoiner <span class="title">add</span><span class="params">(CharSequence newElement)</span> </span>&#123;</span><br><span class="line">        prepareBuilder().append(newElement);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> StringBuilder <span class="title">prepareBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">            value.append(delimiter);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            value = <span class="keyword">new</span> StringBuilder().append(prefix);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组"><a href="#10-在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组" class="headerlink" title="10. 在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组"></a>10. 在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341341353-3aaaf8c1-f768-401d-9afc-44cab28959cb.png#align=left&amp;display=inline&amp;height=561&amp;margin=%5Bobject%20Object%5D&amp;originHeight=561&amp;originWidth=835&amp;status=done&amp;style=none&amp;width=835" alt><br>以后再运行时，直接选择这个compound即可很方便的运行或停止一组微服务：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341341421-c1de2107-d885-4e4b-a9ef-66c53a138b14.png#align=left&amp;display=inline&amp;height=265&amp;margin=%5Bobject%20Object%5D&amp;originHeight=265&amp;originWidth=744&amp;status=done&amp;style=none&amp;width=744" alt><br>另外可以单独为每个微服务，设置需要的运行时最大堆内存大小：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/512093/1591341341484-8370bb82-cb92-4e23-9f7d-e205318fb997.png#align=left&amp;display=inline&amp;height=491&amp;margin=%5Bobject%20Object%5D&amp;originHeight=491&amp;originWidth=1003&amp;status=done&amp;style=none&amp;width=1003" alt></p>
<h3 id="11-mysql的dateTime和timestamp的区别？"><a href="#11-mysql的dateTime和timestamp的区别？" class="headerlink" title="11. mysql的dateTime和timestamp的区别？"></a>11. mysql的dateTime和timestamp的区别？</h3><p><a href="https:_www.cnblogs.com_mxwz_p_7520309" target="_blank" rel="noopener">MySQL中datetime和timestamp的区别及使用</a><br><strong>TIMESTAMP和DATETIME的相同点：</strong><br>1&gt; 两者都可用来表示YYYY-MM-DD HH:MM:SS[.fraction]类型的日期。<br><strong>TIMESTAMP和DATETIME的不同点：</strong><br>1&gt; 两者的存储方式不一样<br>对于TIMESTAMP，它把客户端插入的时间从当前时区转化为UTC（世界标准时间）进行存储。查询时，将其又转化为客户端当前时区进行返回。<br>而对于DATETIME，不做任何改变，基本上是原样输入和输出。<br>2&gt; 两者所能存储的时间范围不一样<br>timestamp所能存储的时间范围为：’1970-01-01 00:00:01.000000’ 到 ‘2038-01-19 03:14:07.999999’。<br>datetime所能存储的时间范围为：’1000-01-01 00:00:00.000000’ 到 ‘9999-12-31 23:59:59.999999’。<br>总结：TIMESTAMP和DATETIME除了存储范围和存储方式不一样，没有太大区别。当然，对于跨时区的业务，TIMESTAMP更为合适。<br><a href="https:_www.cnblogs.com_jashinck_p_10472398" target="_blank" rel="noopener">https://www.cnblogs.com/Jashinck/p/10472398.html</a></p>
<h3 id="12-SpringBoot中的事务"><a href="#12-SpringBoot中的事务" class="headerlink" title="12. SpringBoot中的事务"></a>12. SpringBoot中的事务</h3><p><a href="https://blog.csdn.net/Z__Sheng/article/details/89489053" target="_blank" rel="noopener">https://blog.csdn.net/Z__Sheng/article/details/89489053</a></p>
<h3 id="13-IDEA-RESTFUll-clinet"><a href="#13-IDEA-RESTFUll-clinet" class="headerlink" title="13. IDEA RESTFUll clinet"></a>13. IDEA RESTFUll clinet</h3><p><a href="https://blog.csdn.net/qq_37502106/article/details/103183492" target="_blank" rel="noopener">IntelliJ IDEA 使用 rest client</a></p>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="1-TypeError-vm-previewHandle-is-not-a-function"><a href="#1-TypeError-vm-previewHandle-is-not-a-function" class="headerlink" title="1. TypeError: _vm.previewHandle is not a function"></a>1. TypeError: _vm.previewHandle is not a function</h3>

                <hr>

                

                <ul class="pager">
                    
                    
                        <li class="next">
                            <a href="/2020/07/22/Tree-Questions/" data-toggle="tooltip" data-placement="top" title="Tree Questions">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://blog.kaijun.rocks" target="_blank">Kaijun&#39;s Blog</a></li>
                    
                        <li><a href="http://huangxuan.me" target="_blank">Hux Blog</a></li>
                    
                        <li><a href="#" target="_blank">Foo</a></li>
                    
                        <li><a href="#" target="_blank">Bar</a></li>
                    
                        <li><a href="#" target="_blank">Example Friends</a></li>
                    
                        <li><a href="#" target="_blank">It helps SEO</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>




<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "hexo-theme-huxblog";
    var disqus_identifier = "https://wenyongqd.github.io/2020/07/27/GULI-Basics/";
    var disqus_url = "https://wenyongqd.github.io/2020/07/27/GULI-Basics/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/wenyongqd">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://www.linkedin.com/in/wenyong-he-408621107">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Wenyong&#39;s Blog 2020 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    Ported by <a href="http://blog.kaijun.rocks">Kaijun</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=kaijun&repo=hexo-theme-huxblog&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://wenyongqd.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-49627206-1';
    var _gaDomain = 'undefined';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '4cc1f2d8f3067386cc5cdb626a202900';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>


<!-- Side Catalog -->





<!-- Image to hack wechat -->
<img src="https://wenyongqd.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
